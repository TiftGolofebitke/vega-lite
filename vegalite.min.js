!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vl=e()}}(function(){return function e(t,n,a){function r(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,a)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)r(a[s]);return r}({1:[function(e,t){var n=(e("./globals"),e("./util")),a=e("./consts"),r=n.merge(a,n);r.schema=e("./schema"),r.Encoding=e("./Encoding"),r.axis=e("./axis"),r.compile=e("./compile"),r.data=e("./data"),r.legends=e("./legends"),r.marks=e("./marks"),r.scale=e("./scale"),t.exports=r},{"./Encoding":2,"./axis":3,"./compile":4,"./consts":5,"./data":6,"./globals":7,"./legends":8,"./marks":9,"./scale":10,"./schema":11,"./util":13}],2:[function(e,t){"use strict";{var n=(e("./globals"),e("./consts")),a=e("./util"),r=e("./schema");t.exports=function(){function e(e,t,r){this._marktype=e,this._enc=t,this._cfg=a.merge(Object.create(n.DEFAULTS),r)}var t=e.prototype;return t.marktype=function(){return this._marktype},t.is=function(e){return this._marktype===e},t.has=function(e){return void 0!==this._enc[e]},t.enc=function(e){return this._enc[e]},t.field=function(e,t,n){if(!this.has(e))return null;var a=t?"":"data.";return"count"===this._enc[e].aggr?a+"count":!n&&this._enc[e].bin?a+"bin_"+this._enc[e].name:!n&&this._enc[e].aggr?a+this._enc[e].aggr+"_"+this._enc[e].name:!n&&this._enc[e].fn?a+this._enc[e].fn+"_"+this._enc[e].name:a+this._enc[e].name},t.fieldName=function(e){return this._enc[e].name},t.fieldTitle=function(e){return this._enc[e].aggr?this._enc[e].aggr+"("+this._enc[e].name+")":this._enc[e].name},t.scale=function(e){return this._enc[e].scale||{}},t.axis=function(e){return this._enc[e].axis||{}},t.aggr=function(e){return this._enc[e].aggr},t.bin=function(e){return this._enc[e].bin},t.legend=function(e){return this._enc[e].legend},t.fn=function(e){return this._enc[e].fn},t.any=function(e){return a.any(this._enc,e)},t.all=function(e){return a.all(this._enc,e)},t.length=function(){return a.keys(this._enc).length},t.reduce=function(e,t){var n=t;for(k in this._enc)n=e(n,this._enc[k],k,this._enc);return n},t.forEach=function(e){var t,n=0;for(t in this._enc)e(t,this._enc[t],n++)},t.type=function(e){return this.has(e)?this._enc[e].type:null},t.isType=function(e,t){var n=this.type(e);return null==n?!1:(n&t)>0},t.config=function(e){return this._cfg[e]},t.toSpec=function(e){var t,r=a.duplicate(this._enc);for(var i in r)r[i].type=n.dataTypeNames[r[i].type];return t={marktype:this._marktype,enc:r},e||(t.cfg=a.duplicate(this._cfg)),t},t.toShorthand=function(){var e=this._enc;return this._marktype+"."+a.keys(e).map(function(t){var a=e[t];return t+"-"+(a.aggr?a.aggr+"_":"")+(a.fn?a.fn+"_":"")+(a.bin?"bin_":"")+(a.name||"")+"-"+n.dataTypeNames[a.type]}).join(".")},e.parseShorthand=function(t,a){var i=t.split("."),s=i.shift();return i=i.reduce(function(e,t){var a=t.split("-"),i=a[0],s={name:a[1],type:n.dataTypes[a[2]]};for(var o in r.aggr["enum"]){var l=r.aggr["enum"][o];if(0==s.name.indexOf(l+"_")){s.name=s.name.substr(l.length+1),"count"==l&&0===s.name.length&&(s.name="*"),s.aggr=l;break}}for(var o in r.timefns){var f=r.timefns[o];if(s.name&&0==s.name.indexOf(f+"_")){s.name=s.name.substr(s.length+1),s.fn=f;break}}return s.name&&0==s.name.indexOf("bin_")&&(s.name=s.name.substr(4),s.bin=!0),e[i]=s,e},{}),new e(s,i,a)},e.fromSpec=function(t,r){var i=a.duplicate(t.enc);for(var s in i)i[s].type=n.dataTypes[i[s].type];return new e(t.marktype,i,a.merge(t.cfg,r||{}))},e}()}},{"./consts":5,"./globals":7,"./schema":11,"./util":13}],3:[function(e,t){function n(e,t,n){var r,i=e,s=e==COL,o=e==ROW;s&&(i="x"),o&&(i="y");var r={type:i,scale:e,ticks:3};return t.axis(e).grid&&(r.grid=!0,r.layer="back"),t.axis(e).title&&(r=a(r,e,t,n)),(o||s)&&(r.properties={ticks:{opacity:{value:0}},majorTicks:{opacity:{value:0}},axis:{opacity:{value:0}}}),s&&(r.offset=[n.xAxisMargin||0,t.config("yAxisMargin")],r.orient="top"),"x"==e&&(t.isType(e,O)||t.bin(e))&&(r.properties={labels:{angle:{value:270},align:{value:"right"},baseline:{value:"middle"}}}),r}function a(e,t,n){return e.title=n.fieldTitle(t),t==Y&&(e.titleOffset=60),e}var r=(e("./globals"),e("./util")),i=t.exports={};i.names=function(e){return r.keys(r.keys(e).reduce(function(t,n){var a=e[n].scale;return(a===X||a===Y)&&(t[e[n].scale]=1),t},{}))},i.defs=function(e,t,a){return e.reduce(function(e,r){return e.push(n(r,t,a)),e},[])}},{"./globals":7,"./util":13}],4:[function(e,t){function n(e,t,n){var a=e.fieldName(t);if(e.bin(t)){var r=g.getbins(n[a]);return(r.stop-r.start)/r.step}return n[a].cardinality}function a(e,t){var a=e.has(ROW),r=e.has(COL),i=e.has(X),s=e.has(Y),o=r?n(e,COL,t):1,l=a?n(e,ROW,t):1,f=i?+e.config("cellWidth")||1*e.config("width")/o:"text"===e.marktype()?+e.config("textCellWidth"):+e.config("bandSize"),c=s?+e.config("cellHeight")||1*e.config("height")/l:+e.config("bandSize"),u=e.config("cellPadding"),d=e.config("bandPadding"),p=e.config("_minWidth"),g=e.config("_minHeight");if(i&&(e.isType(X,O)||e.bin(X))){var h=n(e,X,t);f=(h+d)*+e.config("bandSize")}if(p=f*((1+u)*(o-1)+1),s&&(e.isType(Y,O)||e.bin(Y))){var y=n(e,Y,t);c=(y+d)*+e.config("bandSize")}return g=c*((1+u)*(l-1)+1),{cellWidth:f,cellHeight:c,width:p,height:g}}function r(e,t,n,a,r,i,s,o){var l=e.properties.enter,f=[],c=[],u=t.has(ROW),p=t.has(COL),y=t.has(Y)?t.config("xAxisMargin"):void 0;if(l.fill={value:t.config("cellBackgroundColor")},e.from={data:e.marks[0].from.data},e.marks[0].from.transform?delete e.marks[0].from.data:delete e.marks[0].from,u){t.isType(ROW,O)||g.error("Row encoding should be ordinal."),l.y={scale:ROW,field:"keys."+f.length},l.height={value:n},f.push(t.field(ROW));var m;p&&(m=g.duplicate(e.from),m.transform=m.transform||[],m.transform.unshift({type:"facet",keys:[t.field(COL)]}));var b=d("x-axes",{axes:t.has(X)?h.defs(["x"],t):void 0,x:p?{scale:COL,field:"keys.0",offset:y}:{value:y},width:p&&{value:a},from:m});r.marks.push(b),r.axes=r.axes||[],r.axes.push.apply(r.axes,h.defs(["row"],t))}else t.has(X)&&c.push.apply(c,h.defs(["x"],t));if(p){t.isType(COL,O)||g.error("Col encoding should be ordinal."),l.x={scale:COL,field:"keys."+f.length},l.width={value:a},f.push(t.field(COL));var m;u&&(m=g.duplicate(e.from),m.transform=m.transform||[],m.transform.unshift({type:"facet",keys:[t.field(ROW)]}));var b=d("y-axes",{axes:t.has(Y)?h.defs(["y"],t):void 0,y:u&&{scale:ROW,field:"keys.0"},x:u&&{value:y},height:u&&{value:n},from:m});r.marks.push(b),r.axes=r.axes||[],r.axes.push.apply(r.axes,h.defs(["col"],t,{xAxisMargin:y}))}else t.has(Y)&&c.push.apply(c,h.defs(["y"],t));u&&(l.x?l.x.offset=y:l.x={value:y}),r.scales=v.defs(v.names(l).concat(v.names(i.properties.update)),t,{cellWidth:a,cellHeight:n,stack:s,facet:!0,stats:o}),c.length>0&&(e.axes=c);var x=e.from.transform||(e.from.transform=[]);return x.unshift({type:"facet",keys:f}),r}function i(e,t,n,a,r){var i=e.marks,s=d("subfacet",{marks:i});e.marks=[s],s.from=t.from,delete t.from;var o=s.from.transform||(s.from.transform=[]);o.unshift({type:"facet",keys:n}),a&&r.has(COLOR)&&o.unshift({type:"sort",by:r.field(COLOR)})}function s(e){switch(e){case"second":return"getUTCSeconds";case"minute":return"getUTCMinutes";case"hour":return"getUTCHours";case"day":return"getUTCDay";case"date":return"getUTCDate";case"month":return"getUTCMonth";case"year":return"getUTCFullYear"}console.error("no function specified for date")}function o(e,t,n,a){var r=s(a.fn);return e.transform=e.transform||[],e.transform.push({type:"formula",field:t.field(n),expr:"new Date(d.data."+a.name+")."+r+"()"}),e}function l(e,t,n){n=n||{};var a={};return t.forEach(function(e,t){t.bin&&(a[t.name]=t.name)}),a=g.keys(a),0===a.length||n.preaggregatedData?!1:(e.transform||(e.transform=[]),a.forEach(function(t){e.transform.push({type:"bin",field:"data."+t,output:"data.bin_"+t,maxbins:MAX_BINS})}),a)}function f(e,t,n){n=n||{};var a={},r={},i={},s={};return t.forEach(function(e,n){n.aggr?"count"===n.aggr?r.count={op:"count",field:"*"}:r[n.aggr+"|"+n.name]={op:n.aggr,field:"data."+n.name}:(a[n.name]=t.field(e),e==ROW||e==COL?s[n.name]=a[n.name]:e!==X&&e!==Y&&(i[n.name]=a[n.name]))}),a=g.vals(a),r=g.vals(r),r.length>0&&!n.preaggregatedData&&(e.transform||(e.transform=[]),e.transform.push({type:"aggregate",groupby:a,fields:r}),t.marktype()===TEXT&&r.forEach(function(t){var n=t.field.substr(5),a="data."+(t.op?t.op+"_":"")+n;e.transform.push({type:"formula",field:a,expr:"d3.format('.2f')(d."+a+")"})})),{details:g.vals(i),dims:a,facets:g.vals(s),aggregated:r.length>0}}function c(e,t,n,a){if(!m[t.marktype()].stack)return!1;if(!t.has(COLOR))return!1;var r=X,i=Y,s=1;t.isType(X,Q|T)&&!t.isType(Y,Q|T)&&t.has(Y)&&(r=Y,i=X,s=0);var o={name:STACKED,source:TABLE,transform:[{type:"aggregate",groupby:[t.field(r)].concat(a),fields:[{op:"sum",field:t.field(i)}]}]};return a&&a.length>0&&o.transform.push({type:"aggregate",groupby:a,fields:[{op:"max",field:"data.sum_"+t.field(i,!0)}]}),e.data.push(o),n.from.transform=[{type:"stack",point:t.field(r),height:t.field(i),output:{y1:i,y0:i+"2"}}],n.properties.update[i]=n.properties.enter[i]={scale:i,field:i},n.properties.update[i+"2"]=n.properties.enter[i+"2"]={scale:i,field:i+"2"},i}function u(e,t,n){var a=e.prop(t,n);return{type:e.type,from:{data:TABLE},properties:{enter:a,update:a}}}function d(e,t){return t=t||{},{_name:e||void 0,type:"group",from:t.from,properties:{enter:{x:t.x||void 0,y:t.y||void 0,width:t.width||{group:"width"},height:t.height||{group:"height"}}},scales:t.scales||void 0,axes:t.axes||void 0,marks:t.marks||[]}}function p(e,t,n){var a={name:TABLE,format:{type:e.config("dataFormatType")}},r=vl.data.getUrl(e,n);r&&(a.url=r);var i=e.config("useVegaServer");return e.forEach(function(e,t){if(t.type==T)a.format.parse=a.format.parse||{},a.format.parse[t.name]="date";else if(t.type==Q){if(a.format.parse=a.format.parse||{},"count"===t.aggr)var n="count";else if(i&&t.bin)var n="bin_"+t.name;else if(i&&t.aggr)var n=t.aggr+"_"+t.name;else var n=t.name;a.format.parse[n]="number"}}),{width:t.width,height:t.height,padding:"auto",data:[a],marks:[d("cell",{width:t.cellWidth?{value:t.cellWidth}:void 0,height:t.cellHeight?{value:t.cellHeight}:void 0})]}}{var g=(e("./globals"),e("./util")),h=e("./axis"),y=e("./legends"),m=e("./marks"),v=e("./scale");t.exports=function(e,t){var n=a(e,t),s=n.cellWidth,d=n.cellHeight,g=e.any(function(e){return void 0!==e.aggr}),b=p(e,n,t),x=b.marks[0],k=m[e.marktype()],S=u(k,e,{hasAggregate:g}),_=e.has(ROW),E=e.has(COL),A=e.config("useVegaServer");x.marks.push(S),l(b.data[0],e,{preaggregatedData:A});var L=m[e.marktype()].line;A||e.forEach(function(t,n){n.type===T&&n.fn&&o(b.data[0],e,t,n)});var C=f(b.data[0],e,{preaggregatedData:A}),w=C.details,R=w&&w.length>0,H=R&&c(b,e,S,C.facets);if(R&&(H||L)&&i(x,S,w,H,e),L){var z=e.isType(X,Q|T)&&e.isType(Y,O)?Y:X;S.from||(S.from={}),S.from.transform=[{type:"sort",by:e.field(z)}]}return _||E?b=r(x,e,d,s,b,S,H,t):(x.scales=v.defs(v.names(S.properties.update),e,{stack:H,stats:t}),x.axes=h.defs(h.names(S.properties.update),e),x.legends=y.defs(e)),b}}},{"./axis":3,"./globals":7,"./legends":8,"./marks":9,"./scale":10,"./util":13}],5:[function(e,t){var n=(e("./globals"),t.exports={});n.encodingTypes=[X,Y,ROW,COL,SIZE,SHAPE,COLOR,ALPHA,TEXT],n.dataTypes={O:O,Q:Q,T:T},n.dataTypeNames=["O","Q","T"].reduce(function(e,t){return e[n.dataTypes[t]]=t,e},{}),n.DEFAULTS={width:void 0,height:void 0,viewport:void 0,_minWidth:20,_minHeight:20,dataUrl:void 0,useVegaServer:!1,vegaServerUrl:"http://localhost:3001",vegaServerTable:void 0,dataFormatType:"json",cellHeight:200,cellWidth:200,cellPadding:.1,cellBackgroundColor:"#fdfdfd",xAxisMargin:80,yAxisMargin:0,textCellWidth:90,bandSize:21,bandPadding:1,pointSize:50,pointShape:"circle",strokeWidth:2,color:"steelblue",textColor:"black",textAlign:"left",textBaseline:"middle",textMargin:4,font:"Helvetica Neue",fontSize:"12",fontWeight:"normal",fontStyle:"normal",opacity:1,_thickOpacity:.5,_thinOpacity:.2,_xZero:!0,_xReverse:!1,_yZero:!0,_yReverse:!1,timeScaleNice:"day"}},{"./globals":7}],6:[function(e,t){var n=e("./util"),a=t.exports={};a.getUrl=function(e,t){if(!e.config("useVegaServer"))return e.config("dataUrl");if(0!==e.length()){var a=[];e.forEach(function(r,i){var s={name:e.field(r,!0),field:i.name};i.aggr&&(s.aggr=i.aggr),i.bin&&(s.binSize=n.getbins(t[i.name]).step),a.push(s)});var r={table:e.config("vegaServerTable"),fields:a};return e.config("vegaServerUrl")+"/query/?q="+JSON.stringify(r)}},a.getSchema=function(e){var t=[],a=n.keys(e[0]);return a.forEach(function(n){for(var a=0,r=e[a][n];""===r||null===r||void 0===r;)r=e[++a][n];var i="number"==typeof r?"Q":isNaN(Date.parse(r))?"O":"T";t.push({name:n,type:i})}),t},a.getStats=function(e){var t={},a=n.keys(e[0]);return a.forEach(function(a){var r=n.minmax(e,a);r.cardinality=n.uniq(e,a),r.count=e.length,t[a]=r}),t}},{"./util":13}],7:[function(){(function(e){var t=e||window;t.TABLE="table",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.ALPHA="alpha",t.TEXT="text",t.O=1,t.Q=2,t.T=4,t.MAX_BINS=20}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t){var n=(e("./globals"),t.exports={});n.defs=function(e){var t=[];if(e.has(COLOR)&&e.legend(COLOR)&&t.push({fill:COLOR,title:e.fieldTitle(COLOR),orient:"right"}),e.has(SIZE)&&e.legend(SIZE)&&t.push({size:SIZE,title:e.fieldTitle(SIZE),orient:1===t.length?"left":"right"}),e.has(SHAPE)&&e.legend(SHAPE)){if(2===t.length)return console.error("Vegalite currently only supports two legends"),t;t.push({shape:SHAPE,title:e.fieldTitle(SHAPE),orient:1===t.length?"left":"right"})}return t}},{"./globals":7}],9:[function(e,t){function n(e){var t={};return e.isType(X,Q|T)&&!e.bin(X)?(t.x={scale:X,field:e.field(X)},!e.has(Y)||e.isType(Y,Q|T)&&!e.bin(Y)||(t.x2={scale:X,value:0})):t.xc=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isType(Y,Q|T)&&!e.bin(Y)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.yc=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.isType(X,Q|T)?e.isType(Y,O)||e.bin(Y)||(t.width={value:+e.config("bandSize"),offset:-1}):t.width=e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:+e.config("bandSize"),offset:-1},e.isType(Y,Q|T)?e.isType(X,O)||e.bin(X)||(t.height={value:+e.config("bandSize"),offset:-1}):t.height=e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:+e.config("bandSize"),offset:-1},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.config("color")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t}function a(e,t){var n={};return t=t||{},e.has(X)?n.x={scale:X,field:e.field(X)}:e.has(X)||(n.x={value:e.config("bandSize")/2}),e.has(Y)?n.y={scale:Y,field:e.field(Y)}:e.has(Y)||(n.y={value:e.config("bandSize")/2}),e.has(SIZE)?n.size={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(n.size={value:e.config("pointSize")}),e.has(SHAPE)?n.shape={scale:SHAPE,field:e.field(SHAPE)}:e.has(SHAPE)||(n.shape={value:e.config("pointShape")}),e.has(COLOR)?n.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(n.stroke={value:e.config("color")}),n.opacity=e.has(ALPHA)?{scale:ALPHA,field:e.field(ALPHA)}:{value:e.config("opacity")||e.config(t.hasAggregate?"_thickOpacity":"_thinOpacity")},n.strokeWidth={value:e.config("strokeWidth")},n}function r(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:0}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={group:"height"}),e.has(COLOR)?t.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.stroke={value:e.config("color")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t.strokeWidth={value:e.config("strokeWidth")},t}function i(e){var t={};return e.isType(X,Q|T)?(t.x={scale:X,field:e.field(X)},!e.isType(Y,Q|T)&&e.has(Y)&&(t.x2={scale:X,value:0},t.orient={value:"horizontal"})):t.x=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isType(Y,Q|T)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.y=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.config("color")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t}function s(e){return function(t,n){var a={};return n=n||{},t.has(X)?a.x={scale:X,field:t.field(X)}:t.has(X)||(a.x={value:t.config("bandSize")/2}),t.has(Y)?a.y={scale:Y,field:t.field(Y)}:t.has(Y)||(a.y={value:t.config("bandSize")/2}),t.has(SIZE)?a.size={scale:SIZE,field:t.field(SIZE)}:t.has(X)||(a.size={value:t.config("pointSize")}),a.shape={value:e},t.has(COLOR)?a.fill={scale:COLOR,field:t.field(COLOR)}:t.has(COLOR)||(a.fill={value:t.config("color")}),a.opacity=t.has(ALPHA)?{scale:ALPHA,field:t.field(ALPHA)}:{value:t.config("opacity")||t.config(n.hasAggregate?"_thickOpacity":"_thinOpacity")},a}}function o(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:e.config("bandSize")/2}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={value:e.config("bandSize")/2}),e.has(SIZE)?t.fontSize={scale:SIZE,field:e.field(SIZE)}:e.has(X)||(t.fontSize={value:e.config("fontSize")}),e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.config("textColor")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t.text=e.has(TEXT)?{field:e.field(TEXT)}:{value:"Abc"},t.font={value:e.config("font")},t.fontWeight={value:e.config("fontWeight")},t.fontStyle={value:e.config("fontStyle")},t.baseline={value:e.config("textBaseline")},e.has(X)?e.isType(X,O)?(t.align={value:"left"},t.dx={value:e.config("textMargin")}):t.align={value:"center"}:e.has(Y)?(t.align={value:"left"},t.dx={value:e.config("textMargin")}):t.align={value:e.config("textAlign")},t}var l=(e("./globals"),e("./util"),t.exports={});l.bar={type:"rect",stack:!0,prop:n,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},l.line={type:"line",line:!0,prop:r,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1}},l.area={type:"area",stack:!0,line:!0,requiredEncoding:["x","y"],prop:i,supportedEncoding:l.line.supportedEncoding},l.circle={type:"symbol",prop:s("circle"),supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},l.square={type:"symbol",prop:s("square"),supportedEncoding:l.circle.supportedEncoding},l.point={type:"symbol",prop:a,supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,shape:1}},l.text={type:"text",prop:o,requiredEncoding:["text"],supportedEncoding:{row:1,col:1,size:1,color:1,alpha:1,text:1}}},{"./globals":7,"./util":13}],10:[function(e,t){function n(e,t){switch(t.type(e)){case O:return"ordinal";case T:return t.fn(e)?"linear":"time";case Q:return t.bin(e)?"ordinal":t.scale(e).type||"linear"}}function a(e,t,n){if(t.type(e)===T)switch(t.fn(e)){case"second":case"minute":return[0,59];case"hour":return[0,23];case"day":return[0,6];case"date":return[1,31];case"month":return[0,11]}if(t.bin(e)&&n.stats){var a=i.getbins(n.stats[t.fieldName(e)]),r=i.range(a.start,a.stop,a.step);return e===Y?r.reverse():r}return e==n.stack?{data:STACKED,field:"data."+(n.facet?"max_":"")+"sum_"+t.field(e,!0)}:{data:TABLE,field:t.field(e)}}function r(e,t,n){var a=t.scale(e.name);switch(e.name){case X:t.isType(e.name,O)||t.bin(e.name)?e.bandWidth=+t.config("bandSize"):(e.range=n.cellWidth?[0,n.cellWidth]:"width",e.zero=a.zero||t.config("_xZero"),e.reverse=a.reverse||t.config("_xReverse")),e.round=!0,e.nice=t.isType(e.name,T)?t.aggr(e.name)||t.config("timeScaleNice"):!0;break;case Y:t.isType(e.name,O)||t.bin(e.name)?e.bandWidth=+t.config("bandSize"):(e.range=n.cellHeight?[n.cellHeight,0]:"height",e.zero=a.zero||t.config("_yZero"),e.reverse=a.reverse||t.config("_yReverse")),e.round=!0,e.nice=t.isType(e.name,T)?t.aggr(e.name):!0;break;case ROW:e.bandWidth=n.cellHeight||t.config("cellHeight"),e.round=!0,e.nice=!0;break;case COL:e.bandWidth=n.cellWidth||t.config("cellWidth"),e.round=!0,e.nice=!0;break;case SIZE:e.range=t.is("bar")?[3,+t.config("bandSize")]:t.is(TEXT)?[8,40]:[10,1e3],e.round=!0,e.zero=!1;break;case SHAPE:e.range="shapes";break;case COLOR:t.isType(e.name,O)?e.range="category10":(e.range=["#ddf","steelblue"],e.zero=!1);break;case ALPHA:e.range=[.2,1];break;default:throw new Error("Unknown encoding name: "+e.name)}switch(e.name){case ROW:case COL:e.padding=t.config("cellPadding"),e.outerPadding=0;break;case X:case Y:(t.isType(e.name,O)||t.bin(e.name))&&(e.points=!0,e.padding=t.config("bandPadding"))}}var i=(e("./globals"),e("./util")),s=t.exports={};s.names=function(e){return i.keys(i.keys(e).reduce(function(t,n){return e[n]&&e[n].scale&&(t[e[n].scale]=1),t},{}))},s.defs=function(e,t,i){return i=i||{},e.reduce(function(e,s){var o={name:s,type:n(s,t),domain:a(s,t,i)};return"ordinal"!==o.type||t.bin(s)||(o.sort=!0),r(o,t,i),e.push(o),e},[])}},{"./globals":7,"./util":13}],11:[function(e,t){var n=t.exports={},a=e("./util");n.util=e("./schemautil"),n.marktype={type:"string","enum":["point","bar","line","area","circle","square","text"]},n.aggr={type:"string","enum":["avg","sum","min","max","count"],supportedEnums:{Q:["avg","sum","min","max","count"],O:["count"],T:["avg","min","max","count"],"":["count"]},supportedTypes:{Q:!0,O:!0,T:!0,"":!0}},n.timefns=["month","year","day","date","hour","minute","second"],n.fn={type:"string","enum":n.timefns,supportedTypes:{T:!0}},n.scale_type={type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:{Q:!0}},n.field={type:"object",required:["name","type"],properties:{name:{type:"string"}}};var r=a.duplicate,i=n.util.merge,s=i(r(n.field),{type:"object",properties:{type:{type:"string","enum":["O","Q","T"]},bin:{type:"boolean",supportedTypes:{Q:!0,O:!0}},aggr:n.aggr,fn:n.fn,scale:{type:"object",properties:{type:n.scale_type,reverse:{type:"boolean","default":!1},zero:{type:"boolean",description:"Include zero","default":!1,supportedTypes:{Q:!0}},nice:{type:"string","enum":["second","minute","hour","day","week","month","year"],supportedTypes:{T:!0}}}}}}),o=i(r(n.field),{type:"object",properties:{type:{type:"string","enum":["O"]},bin:{type:"boolean",supportedTypes:{O:!0}},aggr:{type:"string","enum":["count"],supportedTypes:{O:!0}}}}),l={type:"object",properties:{axis:{type:"object",properties:{grid:{type:"boolean","default":!1},title:{type:"boolean","default":!0}}}}},f={type:"object",properties:{legend:{type:"boolean","default":!0}}},c={type:"object",properties:{text:{type:"object",properties:{weight:{type:"string","enum":["normal","bold"],"default":"normal",supportedTypes:{T:!0}},size:{type:"integer","default":10,minimum:0,supportedTypes:{T:!0}},font:{type:"string","default":"Halvetica Neue",supportedTypes:{T:!0}}}}}},u=i(r(s),l),d=r(u),p=r(o),g=r(p),h=i(r(s),f),y=i(r(s),f),m=r(s),v=i(r(o),f),b=i(r(s),c),O={type:"object",properties:{dataFormatType:{type:"string","enum":["json","csv"]},useVegaServer:{type:"boolean","default":!1},dataUrl:{type:"string"},vegaServerTable:{type:"string"},vegaServerUrl:{type:"string","default":"http://localhost:3001"}}};n.schema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:["marktype","enc","cfg"],properties:{marktype:n.marktype,enc:{type:"object",properties:{x:u,y:d,row:p,col:g,size:h,color:y,alpha:m,shape:v,text:b}},cfg:O}},n.instantiate=function(){return n.util.instantiate(n.schema)}},{"./schemautil":12,"./util":13}],12:[function(e,t){var n=t.exports={},a=function(e){return 0===Object.keys(e).length};n.instantiate=function(e,t){if("object"===e.type){e.required=e.required?e.required:[];var a={};for(var r in e.properties){var i=e.properties[r];a[r]=n.instantiate(i,-1!=e.required.indexOf(r))}return a}return"default"in e?e["default"]:e["enum"]&&t?e["enum"][0]:void 0},n.difference=function(e,t){var r={};for(var i in t)if(!e||e[i]!==t[i])if("object"==typeof t[i]){var s=n.difference(e[i],t[i]);a(s)||(r[i]=s)}else r[i]=t[i];return r},n.merge=function(e,t){if("object"!=typeof t||null===t)return e;for(var a in t)t.hasOwnProperty(a)&&void 0!==t[a]&&("object"!=typeof t[a]||null===t[a]?e[a]=t[a]:"object"!=typeof e[a]||null===e[a]?e[a]=n.merge(t[a].constructor===Array?[]:{},t[a]):n.merge(e[a],t[a]));return e}},{}],13:[function(e,t){var n=t.exports={};n.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},n.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},n.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var a,r=[],i=-1;if(0>n)for(;(a=e+n*++i)>t;)r.push(a);else for(;(a=e+n*++i)<t;)r.push(a);return r},n.find=function(e,t){var n=e.filter(function(e){return e[t.name]===t.value});return n.length&&n[0]||null},n.uniq=function(e,t){var n,a,r={},i=0;for(n=0;n<e.length;++n)a=e[n][t],r[a]||(r[a]=1,i+=1);return i},n.minmax=function(e,t){var n={min:+1/0,max:-1/0};for(i=0;i<e.length;++i){var a=e[i][t];a>n.max&&(n.max=a),a<n.min&&(n.min=a)}return n},n.duplicate=function(e){return JSON.parse(JSON.stringify(e))},n.any=function(e,t){var n,a=0;for(n in e)if(t(e[n],n,a++))return!0;return!1},n.all=function(e,t){var n,a=0;for(n in e)if(!t(e[n],n,a++))return!1;return!0},n.merge=function(e,t){return n.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},n.getbins=function(e){return vg.bins({min:e.min,max:e.max,maxbins:MAX_BINS})},n.error=function(e){console.error("[VL Error]",e)}},{}]},{},[1])(1)});
//# sourceMappingURL=vegalite.min.js.map