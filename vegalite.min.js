!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vl=e()}}(function(){return function e(t,a,n){function r(s,o){if(!a[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var c=a[s]={exports:{}};t[s][0].call(c.exports,function(e){var a=t[s][1][e];return r(a?a:e)},c,c.exports,e,t,a,n)}return a[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t){var a=(e("./globals"),e("./util")),n=e("./consts"),r=a.merge(n,a);r.schema=e("./schema"),r.Encoding=e("./Encoding"),r.axis=e("./axis"),r.compile=e("./compile"),r.data=e("./data"),r.legends=e("./legends"),r.marks=e("./marks"),r.scale=e("./scale"),t.exports=r},{"./Encoding":2,"./axis":3,"./compile":4,"./consts":5,"./data":6,"./globals":7,"./legends":8,"./marks":9,"./scale":10,"./schema":11,"./util":14}],2:[function(e,t){"use strict";{var a=(e("./globals"),e("./consts")),n=e("./util"),r=e("./schema");t.exports=function(){function e(e,t,n){var i=r.util.instantiate(r.schema.properties.enc),s=r.util.instantiate(r.schema.properties.cfg);for(var o in a.DEFAULTS)s[o]=a.DEFAULTS[o];for(var o in i)t[o]||delete i[o];this._marktype=e,this._enc=r.util.merge(i,t),this._cfg=r.util.merge(s,n)}var t=e.prototype;return t.marktype=function(){return this._marktype},t.is=function(e){return this._marktype===e},t.has=function(e){return void 0!==this._enc[e]},t.enc=function(e){return this._enc[e]},t.field=function(e,t,a){if(!this.has(e))return null;var n=t?"":"data.";return"count"===this._enc[e].aggr?n+"count":!a&&this._enc[e].bin?n+"bin_"+this._enc[e].name:!a&&this._enc[e].aggr?n+this._enc[e].aggr+"_"+this._enc[e].name:!a&&this._enc[e].fn?n+this._enc[e].fn+"_"+this._enc[e].name:n+this._enc[e].name},t.fieldName=function(e){return this._enc[e].name},t.fieldTitle=function(e){return this._enc[e].aggr?this._enc[e].aggr+"("+this._enc[e].name+")":this._enc[e].name},t.scale=function(e){return this._enc[e].scale||{}},t.axis=function(e){return this._enc[e].axis||{}},t.aggr=function(e){return this._enc[e].aggr},t.bin=function(e){return this._enc[e].bin},t.legend=function(e){return this._enc[e].legend},t.fn=function(e){return this._enc[e].fn},t.any=function(e){return n.any(this._enc,e)},t.all=function(e){return n.all(this._enc,e)},t.length=function(){return n.keys(this._enc).length},t.reduce=function(e,t){var a=t;for(k in this._enc)a=e(a,this._enc[k],k,this._enc);return a},t.forEach=function(e){var t,a=0;for(t in this._enc)e(t,this._enc[t],a++)},t.type=function(e){return this.has(e)?this._enc[e].type:null},t.isType=function(e,t){var a=this.type(e);return null==a?!1:(a&t)>0},t.config=function(e){return this._cfg[e]},t.toSpec=function(e){var t,r=n.duplicate(this._enc);for(var i in r)r[i].type=a.dataTypeNames[r[i].type];return t={marktype:this._marktype,enc:r},e||(t.cfg=n.duplicate(this._cfg)),t},t.toShorthand=function(){var e=this._enc;return this._marktype+"."+n.keys(e).map(function(t){var n=e[t];return t+"-"+(n.aggr?n.aggr+"_":"")+(n.fn?n.fn+"_":"")+(n.bin?"bin_":"")+(n.name||"")+"-"+a.dataTypeNames[n.type]}).join(".")},e.parseShorthand=function(t,n){var i=t.split("."),s=i.shift();return i=i.reduce(function(e,t){var n=t.split("-"),i=n[0],s={name:n[1],type:a.dataTypes[n[2]]};for(var o in r.aggr["enum"]){var l=r.aggr["enum"][o];if(0==s.name.indexOf(l+"_")){s.name=s.name.substr(l.length+1),"count"==l&&0===s.name.length&&(s.name="*"),s.aggr=l;break}}for(var o in r.timefns){var f=r.timefns[o];if(s.name&&0==s.name.indexOf(f+"_")){s.name=s.name.substr(s.length+1),s.fn=f;break}}return s.name&&0==s.name.indexOf("bin_")&&(s.name=s.name.substr(4),s.bin=!0),e[i]=s,e},{}),new e(s,i,n)},e.fromSpec=function(t,r){var i=n.duplicate(t.enc);for(var s in i)i[s].type=a.dataTypes[i[s].type];return new e(t.marktype,i,n.merge(t.cfg,r||{}))},e}()}},{"./consts":5,"./globals":7,"./schema":11,"./util":14}],3:[function(e,t){function a(e,t,a){return e.title=a.fieldTitle(t),t==Y&&(e.titleOffset=60),e}var n=(e("./globals"),e("./util")),r=t.exports={};r.names=function(e){return n.keys(n.keys(e).reduce(function(t,a){var n=e[a].scale;return(n===X||n===Y)&&(t[e[a].scale]=1),t},{}))},r.defs=function(e,t,a){return e.reduce(function(e,n){return e.push(r.def(n,t,a)),e},[])},r.def=function(e,t,n){var r=e,i=e==COL,s=e==ROW;i&&(r="x"),s&&(r="y");var o={type:r,scale:e};if(t.isType(e,Q)&&(o.ticks=3),t.axis(e).grid&&(o.grid=!0,o.layer="back"),t.axis(e).title&&(o=a(o,e,t,n)),(s||i)&&(o.properties={ticks:{opacity:{value:0}},majorTicks:{opacity:{value:0}},axis:{opacity:{value:0}}}),i&&(o.offset=[n.xAxisMargin||0,t.config("yAxisMargin")],o.orient="top"),"x"==e&&(t.isType(e,O|T)||t.bin(e))&&(o.properties={labels:{angle:{value:270},align:{value:"right"},baseline:{value:"middle"}}}),t.isType(e,T)){var l=t.fn(e),f=o.properties=o.properties||{},c=f.labels=f.labels||{},u=c.text=c.text||{};switch(l){case"day":case"month":u.scale="time-"+l}}return o}},{"./globals":7,"./util":14}],4:[function(e,t){function a(e,t,a){var n=e.fieldName(t);if(e.bin(t)){var r=d.getbins(a[n]);return(r.stop-r.start)/r.step}return a[n].cardinality}function n(e,t){var n=e.has(ROW),r=e.has(COL),i=e.has(X),s=e.has(Y),o=r?a(e,COL,t):1,l=n?a(e,ROW,t):1,f=i?+e.config("cellWidth")||1*e.config("width")/o:"text"===e.marktype()?+e.config("textCellWidth"):+e.config("bandSize"),c=s?+e.config("cellHeight")||1*e.config("height")/l:+e.config("bandSize"),u=e.config("cellPadding"),d=e.config("bandPadding"),p=e.config("_minWidth"),g=e.config("_minHeight");if(i&&(e.isType(X,O)||e.bin(X))){var h=a(e,X,t);f=(h+d)*+e.config("bandSize")}if(p=f*((1+u)*(o-1)+1),s&&(e.isType(Y,O)||e.bin(Y))){var y=a(e,Y,t);c=(y+d)*+e.config("bandSize")}return g=c*((1+u)*(l-1)+1),{cellWidth:f,cellHeight:c,width:p,height:g}}function r(e,t,a,n,r,i,s,o){var l=e.properties.enter,f=[],u=[],g=t.has(ROW),h=t.has(COL),m=t.has(Y)?t.config("xAxisMargin"):void 0;if(l.fill={value:t.config("cellBackgroundColor")},e.from={data:e.marks[0].from.data},e.marks[0].from.transform?delete e.marks[0].from.data:delete e.marks[0].from,g){t.isType(ROW,O)||d.error("Row encoding should be ordinal."),l.y={scale:ROW,field:"keys."+f.length},l.height={value:a},f.push(t.field(ROW));var v;h&&(v=d.duplicate(e.from),v.transform=v.transform||[],v.transform.unshift({type:"facet",keys:[t.field(COL)]}));var b=c("x-axes",{axes:t.has(X)?p.defs(["x"],t):void 0,x:h?{scale:COL,field:"keys.0",offset:m}:{value:m},width:h&&{value:n},from:v});r.marks.push(b),r.axes=r.axes||[],r.axes.push.apply(r.axes,p.defs(["row"],t))}else t.has(X)&&u.push.apply(u,p.defs(["x"],t));if(h){t.isType(COL,O)||d.error("Col encoding should be ordinal."),l.x={scale:COL,field:"keys."+f.length},l.width={value:n},f.push(t.field(COL));var v;g&&(v=d.duplicate(e.from),v.transform=v.transform||[],v.transform.unshift({type:"facet",keys:[t.field(ROW)]}));var b=c("y-axes",{axes:t.has(Y)?p.defs(["y"],t):void 0,y:g&&{scale:ROW,field:"keys.0"},x:g&&{value:m},height:g&&{value:a},from:v});r.marks.push(b),r.axes=r.axes||[],r.axes.push.apply(r.axes,p.defs(["col"],t,{xAxisMargin:m}))}else t.has(Y)&&u.push.apply(u,p.defs(["y"],t));g&&(l.x?l.x.offset=m:l.x={value:m}),r.scales=(r.scales||[]).concat(y.defs(y.names(l).concat(y.names(i.properties.update)),t,{cellWidth:n,cellHeight:a,stack:s,facet:!0,stats:o})),u.length>0&&(e.axes=u);var x=e.from.transform||(e.from.transform=[]);return x.unshift({type:"facet",keys:f}),r}function i(e,t,a,n,r){var i=e.marks,s=c("subfacet",{marks:i});e.marks=[s],s.from=t.from,delete t.from;var o=s.from.transform||(s.from.transform=[]);o.unshift({type:"facet",keys:a}),n&&r.has(COLOR)&&o.unshift({type:"sort",by:r.field(COLOR)})}function s(e,t,a){a=a||{};var n={};return t.forEach(function(e,t){t.bin&&(n[t.name]=t.name)}),n=d.keys(n),0===n.length||a.preaggregatedData?!1:(e.transform||(e.transform=[]),n.forEach(function(t){e.transform.push({type:"bin",field:"data."+t,output:"data.bin_"+t,maxbins:MAX_BINS})}),n)}function o(e,t,a){a=a||{};var n={},r={},i={},s={};return t.forEach(function(e,a){a.aggr?"count"===a.aggr?r.count={op:"count",field:"*"}:r[a.aggr+"|"+a.name]={op:a.aggr,field:"data."+a.name}:(n[a.name]=t.field(e),e==ROW||e==COL?s[a.name]=n[a.name]:e!==X&&e!==Y&&(i[a.name]=n[a.name]))}),n=d.vals(n),r=d.vals(r),r.length>0&&!a.preaggregatedData&&(e.transform||(e.transform=[]),e.transform.push({type:"aggregate",groupby:n,fields:r}),t.marktype()===TEXT&&r.forEach(function(t){var a=t.field.substr(5),n="data."+(t.op?t.op+"_":"")+a;e.transform.push({type:"formula",field:n,expr:"d3.format('.2f')(d."+n+")"})})),{details:d.vals(i),dims:n,facets:d.vals(s),aggregated:r.length>0}}function l(e,t,a,n){if(!h[t.marktype()].stack)return!1;if(!t.has(COLOR))return!1;var r=X,i=Y,s=1;t.isType(X,Q|T)&&!t.isType(Y,Q|T)&&t.has(Y)&&(r=Y,i=X,s=0);var o={name:STACKED,source:TABLE,transform:[{type:"aggregate",groupby:[t.field(r)].concat(n),fields:[{op:"sum",field:t.field(i)}]}]};return n&&n.length>0&&o.transform.push({type:"aggregate",groupby:n,fields:[{op:"max",field:"data.sum_"+t.field(i,!0)}]}),e.data.push(o),a.from.transform=[{type:"stack",point:t.field(r),height:t.field(i),output:{y1:i,y0:i+"2"}}],a.properties.update[i]=a.properties.enter[i]={scale:i,field:i},a.properties.update[i+"2"]=a.properties.enter[i+"2"]={scale:i,field:i+"2"},i}function f(e,t,a){var n=e.prop(t,a);return{type:e.type,from:{data:TABLE},properties:{enter:n,update:n}}}function c(e,t){return t=t||{},{_name:e||void 0,type:"group",from:t.from,properties:{enter:{x:t.x||void 0,y:t.y||void 0,width:t.width||{group:"width"},height:t.height||{group:"height"}}},scales:t.scales||void 0,axes:t.axes||void 0,marks:t.marks||[]}}function u(e,t,a){var n={name:TABLE,format:{type:e.config("dataFormatType")}},r=vl.data.getUrl(e,a);r&&(n.url=r);var i=e.config("useVegaServer");return e.forEach(function(e,t){if(t.type==T)n.format.parse=n.format.parse||{},n.format.parse[t.name]="date";else if(t.type==Q){if(n.format.parse=n.format.parse||{},"count"===t.aggr)var a="count";else if(i&&t.bin)var a="bin_"+t.name;else if(i&&t.aggr)var a=t.aggr+"_"+t.name;else var a=t.name;n.format.parse[a]="number"}}),{width:t.width,height:t.height,padding:"auto",data:[n],marks:[c("cell",{width:t.cellWidth?{value:t.cellWidth}:void 0,height:t.cellHeight?{value:t.cellHeight}:void 0})]}}{var d=(e("./globals"),e("./util")),p=e("./axis"),g=e("./legends"),h=e("./marks"),y=e("./scale"),m=e("./time");t.exports=function(e,t){var a=n(e,t),c=a.cellWidth,d=a.cellHeight,v=e.any(function(e){return void 0!==e.aggr}),b=u(e,a,t),x=b.marks[0],k=h[e.marktype()],S=f(k,e,{hasAggregate:v}),_=e.has(ROW),E=e.has(COL),L=e.config("useVegaServer");x.marks.push(S),s(b.data[0],e,{preaggregatedData:L});var A=h[e.marktype()].line;L||(b=m(b,e));var C=o(b.data[0],e,{preaggregatedData:L}),w=C.details,R=w&&w.length>0,H=R&&l(b,e,S,C.facets);if(R&&(H||A)&&i(x,S,w,H,e),A){var z=e.isType(X,Q|T)&&e.isType(Y,O)?Y:X;S.from||(S.from={}),S.from.transform=[{type:"sort",by:e.field(z)}]}return _||E?b=r(x,e,d,c,b,S,H,t):(x.scales=y.defs(y.names(S.properties.update),e,{stack:H,stats:t}),x.axes=p.defs(p.names(S.properties.update),e),x.legends=g.defs(e)),b}}},{"./axis":3,"./globals":7,"./legends":8,"./marks":9,"./scale":10,"./time":13,"./util":14}],5:[function(e,t){var a=(e("./globals"),t.exports={});a.encodingTypes=[X,Y,ROW,COL,SIZE,SHAPE,COLOR,ALPHA,TEXT],a.dataTypes={O:O,Q:Q,T:T},a.dataTypeNames=["O","Q","T"].reduce(function(e,t){return e[a.dataTypes[t]]=t,e},{}),a.DEFAULTS={cellHeight:200,cellWidth:200,cellPadding:.1,cellBackgroundColor:"#fdfdfd",xAxisMargin:80,yAxisMargin:0,textCellWidth:90,bandSize:21,bandPadding:1,pointSize:50,pointShape:"circle",strokeWidth:2,color:"steelblue",textColor:"black",textAlign:"left",textBaseline:"middle",textMargin:4,font:"Helvetica Neue",fontSize:"12",fontWeight:"normal",fontStyle:"normal",opacity:1,_thickOpacity:.5,_thinOpacity:.2,_xZero:!0,_xReverse:!1,_yZero:!0,_yReverse:!1,timeScaleNice:"day",timeScaleLabelLength:3}},{"./globals":7}],6:[function(e,t){var a=e("./util"),n=t.exports={};n.getUrl=function(e,t){if(!e.config("useVegaServer"))return e.config("dataUrl");if(0!==e.length()){var n=[];e.forEach(function(r,i){var s={name:e.field(r,!0),field:i.name};i.aggr&&(s.aggr=i.aggr),i.bin&&(s.binSize=a.getbins(t[i.name]).step),n.push(s)});var r={table:e.config("vegaServerTable"),fields:n};return e.config("vegaServerUrl")+"/query/?q="+JSON.stringify(r)}},n.getSchema=function(e){var t=[],n=a.keys(e[0]);return n.forEach(function(a){for(var n=0,r=e[n][a];""===r||null===r||void 0===r;)r=e[++n][a];var i="number"==typeof r?"Q":isNaN(Date.parse(r))?"O":"T";t.push({name:a,type:i})}),t},n.getStats=function(e){var t={},n=a.keys(e[0]);return n.forEach(function(n){var r=a.minmax(e,n);r.cardinality=a.uniq(e,n),r.count=e.length,t[n]=r}),t}},{"./util":14}],7:[function(){(function(e){var t=e||window;t.TABLE="table",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.ALPHA="alpha",t.TEXT="text",t.O=1,t.Q=2,t.T=4,t.MAX_BINS=20}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t){var a=(e("./globals"),t.exports={});a.defs=function(e){var t=[];if(e.has(COLOR)&&e.legend(COLOR)&&t.push(a.def(COLOR,e,{fill:COLOR,orient:"right"})),e.has(SIZE)&&e.legend(SIZE)&&t.push(a.def(SIZE,e,{size:SIZE,orient:1===t.length?"left":"right"})),e.has(SHAPE)&&e.legend(SHAPE)){if(2===t.length)return console.error("Vegalite currently only supports two _legends"),t;t.push(a.def(SHAPE,e,{shape:SHAPE,orient:1===t.length?"left":"right"}))}return t},a.def=function(e,t,a){var n=a;if(n.title=t.fieldTitle(e),t.isType(e,T)){var r=t.fn(e),i=n.properties=n.properties||{},s=i.labels=i.labels||{},o=s.text=s.text||{};switch(r){case"day":case"month":o.scale="time-"+r}}return n}},{"./globals":7}],9:[function(e,t){function a(e){var t={};return e.isType(X,Q|T)&&!e.bin(X)?(t.x={scale:X,field:e.field(X)},!e.has(Y)||e.isType(Y,Q|T)&&!e.bin(Y)||(t.x2={scale:X,value:0})):t.xc=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isType(Y,Q|T)&&!e.bin(Y)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.yc=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.isType(X,Q|T)?e.isType(Y,O)||e.bin(Y)||(t.width={value:+e.config("bandSize"),offset:-1}):t.width=e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:+e.config("bandSize"),offset:-1},e.isType(Y,Q|T)?e.isType(X,O)||e.bin(X)||(t.height={value:+e.config("bandSize"),offset:-1}):t.height=e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:+e.config("bandSize"),offset:-1},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.config("color")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t}function n(e,t){var a={};return t=t||{},e.has(X)?a.x={scale:X,field:e.field(X)}:e.has(X)||(a.x={value:e.config("bandSize")/2}),e.has(Y)?a.y={scale:Y,field:e.field(Y)}:e.has(Y)||(a.y={value:e.config("bandSize")/2}),e.has(SIZE)?a.size={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(a.size={value:e.config("pointSize")}),e.has(SHAPE)?a.shape={scale:SHAPE,field:e.field(SHAPE)}:e.has(SHAPE)||(a.shape={value:e.config("pointShape")}),e.has(COLOR)?a.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(a.stroke={value:e.config("color")}),a.opacity=e.has(ALPHA)?{scale:ALPHA,field:e.field(ALPHA)}:{value:e.config("opacity")||e.config(t.hasAggregate?"_thickOpacity":"_thinOpacity")},a.strokeWidth={value:e.config("strokeWidth")},a}function r(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:0}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={group:"height"}),e.has(COLOR)?t.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.stroke={value:e.config("color")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t.strokeWidth={value:e.config("strokeWidth")},t}function i(e){var t={};return e.isType(X,Q|T)?(t.x={scale:X,field:e.field(X)},!e.isType(Y,Q|T)&&e.has(Y)&&(t.x2={scale:X,value:0},t.orient={value:"horizontal"})):t.x=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isType(Y,Q|T)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.y=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.config("color")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t}function s(e){return function(t,a){var n={};return a=a||{},t.has(X)?n.x={scale:X,field:t.field(X)}:t.has(X)||(n.x={value:t.config("bandSize")/2}),t.has(Y)?n.y={scale:Y,field:t.field(Y)}:t.has(Y)||(n.y={value:t.config("bandSize")/2}),t.has(SIZE)?n.size={scale:SIZE,field:t.field(SIZE)}:t.has(X)||(n.size={value:t.config("pointSize")}),n.shape={value:e},t.has(COLOR)?n.fill={scale:COLOR,field:t.field(COLOR)}:t.has(COLOR)||(n.fill={value:t.config("color")}),n.opacity=t.has(ALPHA)?{scale:ALPHA,field:t.field(ALPHA)}:{value:t.config("opacity")||t.config(a.hasAggregate?"_thickOpacity":"_thinOpacity")},n}}function o(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:e.config("bandSize")/2}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={value:e.config("bandSize")/2}),e.has(SIZE)?t.fontSize={scale:SIZE,field:e.field(SIZE)}:e.has(X)||(t.fontSize={value:e.config("fontSize")}),e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.config("textColor")}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t.text=e.has(TEXT)?{field:e.field(TEXT)}:{value:"Abc"},t.font={value:e.config("font")},t.fontWeight={value:e.config("fontWeight")},t.fontStyle={value:e.config("fontStyle")},t.baseline={value:e.config("textBaseline")},e.has(X)?e.isType(X,O)?(t.align={value:"left"},t.dx={value:e.config("textMargin")}):t.align={value:"center"}:e.has(Y)?(t.align={value:"left"},t.dx={value:e.config("textMargin")}):t.align={value:e.config("textAlign")},t}var l=(e("./globals"),e("./util"),t.exports={});l.bar={type:"rect",stack:!0,prop:a,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},l.line={type:"line",line:!0,prop:r,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1}},l.area={type:"area",stack:!0,line:!0,requiredEncoding:["x","y"],prop:i,supportedEncoding:l.line.supportedEncoding},l.circle={type:"symbol",prop:s("circle"),supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},l.square={type:"symbol",prop:s("square"),supportedEncoding:l.circle.supportedEncoding},l.point={type:"symbol",prop:n,supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,shape:1}},l.text={type:"text",prop:o,requiredEncoding:["text"],supportedEncoding:{row:1,col:1,size:1,color:1,alpha:1,text:1}}},{"./globals":7,"./util":14}],10:[function(e,t){function a(e,t,a){if(t.type(e)===T)switch(t.fn(e)){case"second":case"minute":return r.range(0,60);case"hour":return r.range(0,24);case"day":return r.range(0,7);case"date":return r.range(0,32);case"month":return r.range(0,12)}if(t.bin(e)&&a.stats){var n=r.getbins(a.stats[t.fieldName(e)]),i=r.range(n.start,n.stop,n.step);return e===Y?i.reverse():i}return e==a.stack?{data:STACKED,field:"data."+(a.facet?"max_":"")+"sum_"+t.field(e,!0)}:{data:TABLE,field:t.field(e)}}function n(e,t,a){var n=t.scale(e.name);switch(e.name){case X:"ordinal"===e.type?e.bandWidth=+t.config("bandSize"):(e.range=a.cellWidth?[0,a.cellWidth]:"width",e.zero=n.zero||t.config("_xZero"),e.reverse=n.reverse||t.config("_xReverse")),e.round=!0,e.nice="time"===e.type?t.fn(e.name)||t.config("timeScaleNice"):!0;break;case Y:"ordinal"===e.type?e.bandWidth=+t.config("bandSize"):(e.range=a.cellHeight?[a.cellHeight,0]:"height",e.zero=n.zero||t.config("_yZero"),e.reverse=n.reverse||t.config("_yReverse")),e.round=!0,e.nice="time"===e.type?t.fn(e.name)||t.config("timeScaleNice"):!0;break;case ROW:e.bandWidth=a.cellHeight||t.config("cellHeight"),e.round=!0,e.nice=!0;break;case COL:e.bandWidth=a.cellWidth||t.config("cellWidth"),e.round=!0,e.nice=!0;break;case SIZE:e.range=t.is("bar")?[3,+t.config("bandSize")]:t.is(TEXT)?[8,40]:[10,1e3],e.round=!0,e.zero=!1;break;case SHAPE:e.range="shapes";break;case COLOR:"ordinal"===e.type?e.range="category10":(e.range=["#ddf","steelblue"],e.zero=!1);break;case ALPHA:e.range=[.2,1];break;default:throw new Error("Unknown encoding name: "+e.name)}switch(e.name){case ROW:case COL:e.padding=t.config("cellPadding"),e.outerPadding=0;break;case X:case Y:"ordinal"===e.type&&(e.points=!0,e.padding=t.config("bandPadding"))}}var r=(e("./globals"),e("./util")),i=t.exports={};i.names=function(e){return r.keys(r.keys(e).reduce(function(t,a){return e[a]&&e[a].scale&&(t[e[a].scale]=1),t},{}))},i.defs=function(e,t,r){return r=r||{},e.reduce(function(e,s){var o={name:s,type:i.type(s,t),domain:a(s,t,r)};return"ordinal"!==o.type||t.bin(s)||(o.sort=!0),n(o,t,r),e.push(o),e},[])},i.type=function(e,t){switch(t.type(e)){case O:return"ordinal";case T:switch(t.fn(e)){case"second":case"minute":case"hour":case"day":case"date":case"month":return"ordinal";case"year":return"linear"}return"time";case Q:return t.bin(e)?"ordinal":t.scale(e).type||"linear"}}},{"./globals":7,"./util":14}],11:[function(e,t){var a=t.exports={},n=e("./util");a.util=e("./schemautil"),a.marktype={type:"string","enum":["point","bar","line","area","circle","square","text"]},a.aggr={type:"string","enum":["avg","sum","min","max","count"],supportedEnums:{Q:["avg","sum","min","max","count"],O:["count"],T:["avg","min","max","count"],"":["count"]},supportedTypes:{Q:!0,O:!0,T:!0,"":!0}},a.timefns=["month","year","day","date","hour","minute","second"],a.fn={type:"string","enum":a.timefns,supportedTypes:{T:!0}},a.scale_type={type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:{Q:!0}},a.field={type:"object",required:["name","type"],properties:{name:{type:"string"}}};var r=n.duplicate,i=a.util.merge,s=i(r(a.field),{type:"object",properties:{type:{type:"string","enum":["O","Q","T"]},bin:{type:"boolean","default":!1,supportedTypes:{Q:!0,O:!0}},aggr:a.aggr,fn:a.fn,scale:{type:"object",properties:{type:a.scale_type,reverse:{type:"boolean","default":!1},zero:{type:"boolean",description:"Include zero","default":!1,supportedTypes:{Q:!0}},nice:{type:"string","enum":["second","minute","hour","day","week","month","year"],supportedTypes:{T:!0}}}}}}),o=i(r(a.field),{type:"object",properties:{type:{type:"string","enum":["O"]},bin:{type:"boolean","default":!1,supportedTypes:{O:!0}},aggr:{type:"string","enum":["count"],supportedTypes:{O:!0}}}}),l={type:"object",properties:{axis:{type:"object",properties:{grid:{type:"boolean","default":!1},title:{type:"boolean","default":!0}}}}},f={type:"object",properties:{legend:{type:"boolean","default":!0}}},c={type:"object",properties:{text:{type:"object",properties:{weight:{type:"string","enum":["normal","bold"],"default":"normal",supportedTypes:{T:!0}},size:{type:"integer","default":10,minimum:0,supportedTypes:{T:!0}},font:{type:"string","default":"Halvetica Neue",supportedTypes:{T:!0}}}}}},u=i(r(s),l),d=r(u),p=r(o),g=r(p),h=i(r(s),f),y=i(r(s),f),m=r(s),v=i(r(o),f),b=i(r(s),c),x={type:"object",properties:{width:{type:"integer","default":void 0},height:{type:"integer","default":void 0},viewport:{type:"array",items:{type:["integer"]},"default":void 0},_minWidth:{type:"integer","default":20},_minHeight:{type:"integer","default":20},dataFormatType:{type:"string","enum":["json","csv"],"default":"json"},useVegaServer:{type:"boolean","default":!1},dataUrl:{type:"string","default":void 0},vegaServerTable:{type:"string","default":void 0},vegaServerUrl:{type:"string","default":"http://localhost:3001"}}};a.schema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:["marktype","enc","cfg"],properties:{marktype:a.marktype,enc:{type:"object",properties:{x:u,y:d,row:p,col:g,size:h,color:y,alpha:m,shape:v,text:b}},cfg:x}},a.instantiate=function(){return a.util.instantiate(a.schema)}},{"./schemautil":12,"./util":14}],12:[function(e,t){var a=t.exports={},n=function(e){return 0===Object.keys(e).length};a.instantiate=function(e,t){if("object"===e.type){var n=e.required?e.required:[],r={};for(var i in e.properties){var s=e.properties[i];r[i]=a.instantiate(s,-1!=n.indexOf(i))}return r}return"default"in e?e["default"]:e["enum"]&&t?e["enum"][0]:void 0},a.difference=function(e,t){var r={};for(var i in t)if(!e||e[i]!==t[i])if("object"==typeof t[i]){var s=a.difference(e[i],t[i]);n(s)||(r[i]=s)}else r[i]=t[i];return r},a.merge=function(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=a.merge(t[n].constructor===Array?[]:{},t[n]):a.merge(e[n],t[n]));return e}},{}],13:[function(e,t){function a(e,t){var n={},r={};t.forEach(function(e,a){a.type===T&&a.fn&&(n[t.field(e)]={field:a,encType:e},r[a.fn]=!0)});var i=e.data[0],s=i.transform=i.transform||[];for(var o in n){var l=n[o];a.transform(s,t,l.encType,l.field)}var f=e.scales=e.scales||[];for(var c in r)a.scale(f,c,t);return e}var n=(e("./globals"),e("./util"));t.exports=a,a.formula=function(e){var t="new Date(d.data."+e.name+")";switch(e.fn){case"second":return t+".getUTCSeconds()";case"minute":return t+".getUTCMinutes()";case"hour":return t+".getUTCHours()";case"day":return t+".getUTCDay()";case"date":return t+".getUTCDate()";case"month":return t+".getUTCMonth()";case"year":return t+".getUTCFullYear()"}console.error("no function specified for date")},a.transform=function(e,t,n,r){e.push({type:"formula",field:t.field(n),expr:a.formula(r)})},a.scale=function(e,t,a){var r=a.config("timeScaleLabelLength");switch(t){case"day":e.push({name:"time-day",type:"ordinal",domain:n.range(0,7),range:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(e){return e.substr(0,r)})});break;case"month":e.push({name:"time-month",type:"ordinal",domain:n.range(0,12),range:["January","February","March","April","May","June","July","August","September","October","November","December"].map(function(e){return e.substr(0,r)})})}}},{"./globals":7,"./util":14}],14:[function(e,t){var a=t.exports={};a.keys=function(e){var t,a=[];for(t in e)a.push(t);return a},a.vals=function(e){var t,a=[];for(t in e)a.push(e[t]);return a},a.range=function(e,t,a){if(arguments.length<3&&(a=1,arguments.length<2&&(t=e,e=0)),(t-e)/a==1/0)throw new Error("infinite range");var n,r=[],i=-1;if(0>a)for(;(n=e+a*++i)>t;)r.push(n);else for(;(n=e+a*++i)<t;)r.push(n);return r},a.find=function(e,t){var a=e.filter(function(e){return e[t.name]===t.value});return a.length&&a[0]||null},a.uniq=function(e,t){var a,n,r={},i=0;for(a=0;a<e.length;++a)n=e[a][t],r[n]||(r[n]=1,i+=1);return i},a.minmax=function(e,t){var a={min:+1/0,max:-1/0};for(i=0;i<e.length;++i){var n=e[i][t];n>a.max&&(a.max=n),n<a.min&&(a.min=n)}return a},a.duplicate=function(e){return JSON.parse(JSON.stringify(e))},a.any=function(e,t){var a,n=0;for(a in e)if(t(e[a],a,n++))return!0;return!1},a.all=function(e,t){var a,n=0;for(a in e)if(!t(e[a],a,n++))return!1;return!0},a.merge=function(e,t){return a.keys(t).reduce(function(e,a){return e[a]=t[a],e},e)},a.getbins=function(e){return vg.bins({min:e.min,max:e.max,maxbins:MAX_BINS})},a.error=function(e){console.error("[VL Error]",e)}},{}]},{},[1])(1)});
//# sourceMappingURL=vegalite.min.js.map