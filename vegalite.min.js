!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vl=e()}}(function(){return function e(t,r,n){function a(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return a(r?r:e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t,r){"use strict";var n=(e("./globals"),e("./util")),a=e("./consts"),i=n.merge(a,n);i.Encoding=e("./Encoding"),i.compile=e("./compile/compile"),i.data=e("./data"),i.field=e("./field"),i.enc=e("./enc"),i.schema=e("./schema/schema"),i.toShorthand=i.Encoding.shorthand,t.exports=i},{"./Encoding":2,"./compile/compile":6,"./consts":20,"./data":21,"./enc":22,"./field":23,"./globals":24,"./schema/schema":25,"./util":27}],2:[function(e,t,r){"use strict";{var n=(e("./globals"),e("./consts")),a=e("./util"),i=e("./field"),s=e("./enc"),o=e("./schema/schema");e("./compile/time"),t.exports=function(){function e(e,t,r,a,i){var s=o.instantiate(),l={marktype:e,enc:t,cfg:r,filter:a||[]};for(var u in s.enc)s.enc[u].type=n.dataTypes[s.enc[u].type];var c=o.util.merge(s,i||{},l);this._marktype=c.marktype,this._enc=c.enc,this._cfg=c.cfg,this._filter=c.filter}var t=e.prototype;return t.marktype=function(){return this._marktype},t.is=function(e){return this._marktype===e},t.has=function(e){return void 0!==this._enc[e].name},t.enc=function(e){return this._enc[e]},t.filter=function(){var e=[],t=this.fields(),r=this;return a.forEach(t,function(t,n){"*"!==n&&(r.config("filterNull").Q&&t.containsType[Q]||r.config("filterNull").T&&t.containsType[T]||r.config("filterNull").O&&t.containsType[O])&&e.push({operands:[n],operator:"notNull"})}),e.concat(this._filter)},t.field=function(e,t,r){if(!this.has(e))return null;var n=t?"":"data.";return"count"===this._enc[e].aggr?n+"count":!r&&this._enc[e].bin?n+"bin_"+this._enc[e].name:!r&&this._enc[e].aggr?n+this._enc[e].aggr+"_"+this._enc[e].name:!r&&this._enc[e].fn?n+this._enc[e].fn+"_"+this._enc[e].name:n+this._enc[e].name},t.fieldName=function(e){return this._enc[e].name},t.fields=function(){return s.fields(this._enc)},t.fieldTitle=function(e){if(i.isCount(this._enc[e]))return i.count.displayName;var t=this._enc[e].aggr||this._enc[e].fn||this._enc[e].bin&&"bin";return t?t.toUpperCase()+"("+this._enc[e].name+")":this._enc[e].name},t.scale=function(e){return this._enc[e].scale||{}},t.axis=function(e){return this._enc[e].axis||{}},t.band=function(e){return this._enc[e].band||{}},t.bandSize=function(e,t){return t=t||e===Y&&this.has(ROW)&&this.has(Y)||e===X&&this.has(COL)&&this.has(X),this.band(e).size||this.config(t?"smallBandSize":"largeBandSize")},t.aggr=function(e){return this._enc[e].aggr},t.bin=function(e){var t=this._enc[e].bin;return t==={}?!1:t===!0?{maxbins:o.MAXBINS_DEFAULT}:t},t.legend=function(e){return this._enc[e].legend},t.value=function(e){return this._enc[e].value},t.fn=function(e){return this._enc[e].fn},t.sort=function(t,r){var n=this._enc[t].sort,a=this._enc,s=i.isType.byCode;if((!n||0===n.length)&&e.toggleSort.support({enc:this._enc},r,!0)&&"Q"===this.config("toggleSort")){var o=s(a.x,O)?a.y:a.x;s(a[t],O)&&(n=[{name:o.name,aggr:o.aggr,type:o.type,reverse:!0}])}return n},t.any=function(e){return a.any(this._enc,e)},t.all=function(e){return a.all(this._enc,e)},t.length=function(){return a.keys(this._enc).length},t.map=function(e){return s.map(this._enc,e)},t.reduce=function(e,t){return s.reduce(this._enc,e,t)},t.forEach=function(e){return s.forEach(this._enc,e)},t.type=function(e){return this.has(e)?this._enc[e].type:null},t.role=function(e){return this.has(e)?i.role(this._enc[e]):null},t.text=function(e){var t=this._enc[TEXT].text;return e?t[e]:t},t.font=function(e){var t=this._enc[TEXT].font;return e?t[e]:t},t.isType=function(t,r){var n=this.enc(t);return n&&e.isType(n,r)},e.isType=function(e,t){return(e.type&t)>0},e.isOrdinalScale=function(e,t){return i.isOrdinalScale(e.enc(t),!0)},e.isDimension=function(e,t){return i.isDimension(e.enc(t),!0)},e.isMeasure=function(e,t){return i.isMeasure(e.enc(t),!0)},t.isOrdinalScale=function(t){return this.has(t)&&e.isOrdinalScale(this,t)},t.isDimension=function(t){return this.has(t)&&e.isDimension(this,t)},t.isMeasure=function(t){return this.has(t)&&e.isMeasure(this,t)},t.isAggregate=function(){return s.isAggregate(this._enc)},e.isAggregate=function(e){return s.isAggregate(e.enc)},e.alwaysNoOcclusion=function(e,t){return s.isAggregate(e.enc)},e.isStack=function(e){return("bar"===e.marktype||"area"===e.marktype)&&e.enc.color},t.isStack=function(){return(this.is("bar")||this.is("area"))&&this.has("color")},t.cardinality=function(e,t){return i.cardinality(this.enc(e),t,this.config("filterNull"),!0)},t.isRaw=function(){return!this.isAggregate()},t.config=function(e){return this._cfg[e]},t.toSpec=function(e){var t,r=a.duplicate(this._enc);for(var i in r)r[i].type=n.dataTypeNames[r[i].type];t={marktype:this._marktype,enc:r,filter:this._filter},e||(t.cfg=a.duplicate(this._cfg));var s=o.instantiate();return o.util.subtract(t,s)},t.toShorthand=function(){var e=n.shorthand;return"mark"+e.assign+this._marktype+e.delim+s.shorthand(this._enc)},e.shorthand=function(e){var t=n.shorthand;return"mark"+t.assign+e.marktype+t.delim+s.shorthand(e.enc)},e.fromShorthand=function(t,r,a){var i=n.shorthand,o=t.split(i.delim),l=o.shift().split(i.assign)[1].trim(),u=s.fromShorthand(o,!0);return new e(l,u,r,null,a)},e.specFromShorthand=function(t,r,n){return e.fromShorthand(t,r).toSpec(n)},e.fromSpec=function(t,r){var i=a.duplicate(t.enc||{});for(var s in i)i[s].type=n.dataTypes[i[s].type];return new e(t.marktype,i,t.cfg,t.filter,r)},e.transpose=function(e){var t=e.enc,r=a.duplicate(e.enc);return r.x=t.y,r.y=t.x,r.row=t.col,r.col=t.row,e.enc=r,e},e.toggleSort=function(e){return e.cfg=e.cfg||{},e.cfg.toggleSort="Q"===e.cfg.toggleSort?"O":"Q",e},e.toggleSort.direction=function(t,r){if(e.toggleSort.support(t,r)){var n=t.enc;return"O"===n.x.type?"x":"y"}},e.toggleSort.mode=function(e){return e.cfg.toggleSort},e.toggleSort.support=function(t,r,n){var a=t.enc,o=i.isType.get(n);return!s.has(a,ROW)&&!s.has(a,COL)&&s.has(a,X)&&s.has(a,Y)&&e.alwaysNoOcclusion(t,r)?o(a.x,O)&&i.isMeasure(a.y,n)?"x":o(a.y,O)&&i.isMeasure(a.x,n)?"y":!1:!1},e.toggleFilterNullO=function(e){return e.cfg=e.cfg||{},e.cfg.filterNull=e.cfg.filterNull||{T:!0,Q:!0},e.cfg.filterNull.O=!e.cfg.filterNull.O,e},e.toggleFilterNullO.support=function(e,t){var r=s.fields(e.enc);for(var n in r){var a=r[n];if(a.containsType.O&&n in t&&t[n].numNulls>0)return!0}return!1},e}()}},{"./compile/time":19,"./consts":20,"./enc":22,"./field":23,"./globals":24,"./schema/schema":25,"./util":27}],3:[function(e,t,r){"use strict";function n(e,t,r){r=r||{};var n={},i={},s={},o={},l=e.data[1];return t.forEach(function(e,r){e.aggr?"count"===e.aggr?i.count={op:"count",field:"*"}:i[e.aggr+"|"+e.name]={op:e.aggr,field:"data."+e.name}:(n[e.name]=t.field(r),r==ROW||r==COL?o[e.name]=n[e.name]:r!==X&&r!==Y&&(s[e.name]=n[e.name]))}),n=a.vals(n),i=a.vals(i),i.length>0&&!r.preaggregatedData&&(l.transform||(l.transform=[]),l.transform.push({type:"aggregate",groupby:n,fields:i})),{details:a.vals(s),dims:n,facets:a.vals(o),aggregated:i.length>0}}var a=(e("../globals"),e("../util"));t.exports=n},{"../globals":24,"../util":27}],4:[function(e,t,r){"use strict";function n(e,t,r,n,a){var l=null,u=r.fieldTitle(t);return t===X?l=n.cellWidth/r.config("characterWidth"):t===Y&&(l=n.cellHeight/r.config("characterWidth")),e.title=l?s.truncate(u,l):u,t===ROW&&o(e,["properties","title"],{angle:{value:0},align:{value:"right"},baseline:{value:"middle"},dy:{value:-n.height/2-20}}),e.titleOffset=i(r,n,t),e}function a(e,t,r,n,a){var i;r.isType(t,T)&&(i=r.fn(t))&&u.hasScale(i)&&o(e,["properties","labels","text","scale"],"time-"+i);var s=["properties","labels","text","template"];return r.axis(t).format?e.format=r.axis(t).format:r.isType(t,Q)?o(e,s,"{{data | number:'.3s'}}"):r.isType(t,T)&&!r.fn(t)?o(e,s,"{{data | time:'%Y-%m-%d'}}"):r.isType(t,T)&&"year"===r.fn(t)?o(e,s,"{{data | number:'d'}}"):r.isType(t,O)&&r.axis(t).maxLabelLength&&o(e,s,"{{data | truncate:"+r.axis(t).maxLabelLength+"}}"),e}function i(e,t,r){var n=e.axis(r).titleOffset;if(n)return n;switch(r){case ROW:return 0;case COL:return 35}return l(t,[r,"axisTitleOffset"])}var s=(e("../globals"),e("../util")),o=s.setter,l=s.getter,u=e("./time"),c=t.exports={};c.names=function(e){return s.keys(s.keys(e).reduce(function(t,r){var n=e[r].scale;return(n===X||n===Y)&&(t[e[r].scale]=1),t},{}))},c.defs=function(e,t,r,n,a){return e.reduce(function(e,i){return e.push(c.def(i,t,r,n,a)),e},[])},c.def=function(e,t,r,s,l){var u=e,c=e==COL,f=e==ROW,d=i(t,r,Y)+20,p=r.cellPadding;c&&(u="x"),f&&(u="y");var m={type:u,scale:e};return t.axis(e).grid&&(m.grid=!0,m.layer=f||c?"front":"back",c?o(m,["properties","grid"],{x:{offset:r.cellWidth*(1+p/2),scale:"col"},y:{value:-r.cellHeight*(p/2)},stroke:{value:t.config("cellGridColor")}}):f?o(m,["properties","grid"],{y:{offset:-r.cellHeight*(p/2),scale:"row"},x:{value:d},x2:{offset:d+.05*r.cellWidth,group:"mark.group.width",mult:1},stroke:{value:t.config("cellGridColor")}}):o(m,["properties","grid","stroke"],{value:t.config("gridColor")})),t.axis(e).title&&(m=n(m,e,t,r,l)),(f||c)&&(o(m,["properties","ticks"],{opacity:{value:0}}),o(m,["properties","majorTicks"],{opacity:{value:0}}),o(m,["properties","axis"],{opacity:{value:0}})),c&&(m.orient="top"),f&&(m.offset=d),e==X&&(t.has(Y)&&t.isOrdinalScale(Y)&&t.cardinality(Y,s)>30&&(m.orient="top"),t.isDimension(X)||t.isType(X,T)?o(m,["properties","labels"],{angle:{value:270},align:{value:"right"},baseline:{value:"middle"}}):m.ticks=5),m=a(m,e,t,r,l)}},{"../globals":24,"../util":27,"./time":19}],5:[function(e,t,r){"use strict";function n(e,t,r){r=r||{};r.preaggregatedData||(e.transform||(e.transform=[]),t.forEach(function(r,n){t.bin(n)&&e.transform.push({type:"bin",field:"data."+r.name,output:"data.bin_"+r.name,maxbins:t.bin(n).maxbins})}))}e("../globals"),e("../util");t.exports=n},{"../globals":24,"../util":27}],6:[function(e,t,r){"use strict";function n(e,t,r){return n.encoding(a.fromSpec(e,r),t)}e("../globals"),e("../util");t.exports=n;var a=e("../Encoding"),i=n.template=e("./template"),s=n.axis=e("./axis"),o=n.filter=e("./filter"),l=n.legend=e("./legend"),u=n.marks=e("./marks"),c=n.scale=e("./scale"),f=n.sort=e("./sort"),d=n.style=e("./style"),p=n.time=e("./time"),m=n.aggregate=e("./aggregate"),g=n.bin=e("./bin"),h=n.facet=e("./facet"),y=n.stack=e("./stack"),v=n.subfacet=e("./subfacet");n.layout=e("./layout"),n.group=e("./group"),n.shorthand=function(e,t,r,i){return n.encoding(a.fromShorthand(e,r,i),t)},n.encoding=function(e,t){var r=n.layout(e,t),a=d(e,t),b=i(e,r,t),O=b.marks[0],x=u[e.marktype()],S=u.def(x,e,r,a),T=S[0];o.addFilters(b,e);for(var L=f(b,e,t),A=e.has(ROW),k=e.has(COL),E=e.config("useVegaServer"),C=0;C<S.length;C++)O.marks.push(S[C]);g(b.data[1],e,{preaggregatedData:E});var R=u[e.marktype()].line;E||(b=p(b,e));var w=m(b,e,{preaggregatedData:E}),_=w.details,H=_&&_.length>0,M=H&&y(b,e,T,w.facets);if(H&&(M||R)&&v(O,T,_,M,e),R){var W=e.isMeasure(X)&&e.isDimension(Y)?Y:X;T.from||(T.from={}),T.from.transform=[{type:"sort",by:"-"+e.field(W)}]}return A||k?(b=h(O,e,r,a,L,b,T,M,t),b.legends=l.defs(e)):(O.scales=c.defs(c.names(T.properties.update),e,r,a,L,{stack:M,stats:t}),O.axes=s.defs(s.names(T.properties.update),e,r,t),O.legends=l.defs(e)),o.filterLessThanZero(b,e),b}},{"../Encoding":2,"../globals":24,"../util":27,"./aggregate":3,"./axis":4,"./bin":5,"./facet":7,"./filter":8,"./group":9,"./layout":10,"./legend":11,"./marks":12,"./scale":13,"./sort":14,"./stack":15,"./style":16,"./subfacet":17,"./template":18,"./time":19}],7:[function(e,t,r){"use strict";function n(e,t,r,n,l,u,c,f,d){var p,m,g=e.properties.enter,h=[],y=[],v=t.has(ROW),b=t.has(COL);g.fill={value:t.config("cellBackgroundColor")},e.from={data:e.marks[0].from.data};for(var O=0;O<e.marks.length;O++){var x=e.marks[O];x.from.transform?delete x.from.data:delete x.from}v?(t.isDimension(ROW)||a.error("Row encoding should be ordinal."),g.y={scale:ROW,field:"keys."+h.length},g.height={value:r.cellHeight},h.push(t.field(ROW)),b&&(p=a.duplicate(e.from),p.transform=p.transform||[],p.transform.unshift({type:"facet",keys:[t.field(COL)]})),m=s("x-axes",{axes:t.has(X)?i.defs(["x"],t,r,d):void 0,x:b?{scale:COL,field:"keys.0"}:{value:0},width:b&&{value:r.cellWidth},from:p}),u.marks.unshift(m),u.axes=u.axes||[],u.axes.push.apply(u.axes,i.defs(["row"],t,r,d))):t.has(X)&&y.push.apply(y,i.defs(["x"],t,r,d)),b?(t.isDimension(COL)||a.error("Col encoding should be ordinal."),g.x={scale:COL,field:"keys."+h.length},g.width={value:r.cellWidth},h.push(t.field(COL)),v&&(p=a.duplicate(e.from),p.transform=p.transform||[],p.transform.unshift({type:"facet",keys:[t.field(ROW)]})),m=s("y-axes",{axes:t.has(Y)?i.defs(["y"],t,r,d):void 0,y:v&&{scale:ROW,field:"keys.0"},x:v&&{value:0},height:v&&{value:r.cellHeight},from:p}),u.marks.unshift(m),u.axes=u.axes||[],u.axes.push.apply(u.axes,i.defs(["col"],t,r,d))):t.has(Y)&&y.push.apply(y,i.defs(["y"],t,r,d)),u.scales=(u.scales||[]).concat(o.defs(o.names(g).concat(o.names(c.properties.update)),t,r,n,l,{stack:f,facet:!0,stats:d})),y.length>0&&(e.axes=y);var S=e.from.transform||(e.from.transform=[]);return S.unshift({type:"facet",keys:h}),u}var a=(e("../globals"),e("../util")),i=e("./axis"),s=e("./group").def,o=e("./scale");t.exports=n},{"../globals":24,"../util":27,"./axis":4,"./group":9,"./scale":13}],8:[function(e,t,r){"use strict";var n=(e("../globals"),t.exports={}),a={">":!0,">=":!0,"=":!0,"!=":!0,"<":!0,"<=":!0};n.addFilters=function(e,t){var r=t.filter(),n=e.data[0];n.transform||(n.transform=[]);for(var i in r){var s=r[i],o="",l=s.operator,u=s.operands;if(a[l]){"="===l&&(l="==");var c=u[0],f=u[1];o="d.data."+c+l+f}else if("notNull"===l)for(var d in u)o+="d.data."+u[d]+"!==null",d<u.length-1&&(o+=" && ");else console.warn("Unsupported operator: ",l);n.transform.push({type:"filter",test:o})}},n.filterLessThanZero=function(e,t){t.forEach(function(r,n){"log"===t.scale(n).type&&e.data[1].transform.push({type:"filter",test:"d."+t.field(n)+">0"})})}},{"../globals":24}],9:[function(e,t,r){"use strict";function n(e,t){return t=t||{},{_name:e||void 0,type:"group",from:t.from,properties:{enter:{x:t.x||void 0,y:t.y||void 0,width:t.width||{group:"width"},height:t.height||{group:"height"}}},scales:t.scales||void 0,axes:t.axes||void 0,marks:t.marks||[]}}t.exports={def:n}},{}],10:[function(e,t,r){"use strict";function n(e,t){var r=a(e,t);return r=i(e,t,r)}function a(e,t){var r,n,a=e.has(ROW),i=e.has(COL),s=e.has(X),o=e.has(Y),l=e.marktype(),u=s&&e.isDimension(X)?e.cardinality(X,t):1,c=o&&e.isDimension(Y)?e.cardinality(Y,t):1,f=u>e.config("largeBandMaxCardinality")||c>e.config("largeBandMaxCardinality"),d=e.config("cellPadding");r=s?e.isOrdinalScale(X)?(u+e.band(X).padding)*e.bandSize(X,f):i||a?e.enc(COL).width:e.config("singleWidth"):l===TEXT?e.config("textCellWidth"):e.bandSize(X),n=o?e.isOrdinalScale(Y)?(c+e.band(Y).padding)*e.bandSize(Y,f):i||a?e.enc(ROW).height:e.config("singleHeight"):e.bandSize(Y);var p=r,m=n;if(i){var g=e.cardinality(COL,t);p=r*((1+d)*(g-1)+1)}if(a){var h=e.cardinality(ROW,t);m=n*((1+d)*(h-1)+1)}return{cellWidth:r,cellHeight:n,cellPadding:d,width:p,height:m,x:{useSmallBand:f},y:{useSmallBand:f}}}function i(e,t,r){return[X,Y].forEach(function(n){var a;e.isDimension(n)||e.isType(n,T)?a=t[e.fieldName(n)].maxlength:"count"===e.aggr(n)?a=3:e.isType(n,Q)&&(a=n===X?3:Math.min(t[e.fieldName(n)].maxlength,7)),o(r,[n,"axisTitleOffset"],e.config("characterWidth")*a+20)}),r}{var s=(e("../globals"),e("../util")),o=s.setter;e("../schema/schema"),e("./time"),e("../field")}t.exports=n},{"../field":23,"../globals":24,"../schema/schema":25,"../util":27,"./time":19}],11:[function(e,t,r){"use strict";var n=(e("../globals"),e("./time")),a=t.exports={};a.defs=function(e){var t=[];if(e.has(COLOR)&&e.legend(COLOR)&&t.push(a.def(COLOR,e,{fill:COLOR,orient:"right"})),e.has(SIZE)&&e.legend(SIZE)&&t.push(a.def(SIZE,e,{size:SIZE,orient:1===t.length?"left":"right"})),e.has(SHAPE)&&e.legend(SHAPE)){if(2===t.length)return console.error("Vegalite currently only supports two legends"),t;t.push(a.def(SHAPE,e,{shape:SHAPE,orient:1===t.length?"left":"right"}))}return t},a.def=function(e,t,r){var a,i=r;if(i.title=t.fieldTitle(e),t.isType(e,T)&&(a=t.fn(e))&&n.hasScale(a)){var s=i.properties=i.properties||{},o=s.labels=s.labels||{},l=o.text=o.text||{};l.scale="time-"+a}return i}},{"../globals":24,"./time":19}],12:[function(e,t,r){"use strict";function n(e,t,r){var n={};return e.isMeasure(X)?(n.x={scale:X,field:e.field(X)},e.isDimension(Y)&&(n.x2={scale:X,value:"log"===e.scale(X).type?1:0})):n.xc=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isMeasure(Y)?(n.y={scale:Y,field:e.field(Y)},n.y2={scale:Y,value:"log"===e.scale(Y).type?1:0}):n.yc=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},n.width=!e.has(X)||e.isOrdinalScale(X)?e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(X,t.x.useSmallBand),offset:-1}:{value:2},n.height=!e.has(Y)||e.isOrdinalScale(Y)?e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(Y,t.y.useSmallBand),offset:-1}:{value:2},n.fill=e.has(COLOR)?{scale:COLOR,field:e.field(COLOR)}:{value:e.value(COLOR)},e.has(ALPHA)?n.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(n.opacity={value:e.value(ALPHA)}),n}function a(e,t,r){var n={};return e.has(X)?n.x={scale:X,field:e.field(X)}:e.has(X)||(n.x={value:e.bandSize(X,t.x.useSmallBand)/2}),e.has(Y)?n.y={scale:Y,field:e.field(Y)}:e.has(Y)||(n.y={value:e.bandSize(Y,t.y.useSmallBand)/2}),e.has(SIZE)?n.size={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(n.size={value:e.value(SIZE)}),e.has(SHAPE)?n.shape={scale:SHAPE,field:e.field(SHAPE)}:e.has(SHAPE)||(n.shape={value:e.value(SHAPE)}),e.has(COLOR)?n.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(n.stroke={value:e.value(COLOR)}),e.has(ALPHA)?n.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?n.opacity={value:e.value(ALPHA)}:e.has(COLOR)||(n.opacity={value:r.opacity}),n.strokeWidth={value:e.config("strokeWidth")},n}function i(e,t,r){var n={};return e.has(X)?n.x={scale:X,field:e.field(X)}:e.has(X)||(n.x={value:0}),e.has(Y)?n.y={scale:Y,field:e.field(Y)}:e.has(Y)||(n.y={group:"height"}),e.has(COLOR)?n.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(n.stroke={value:e.value(COLOR)}),e.has(ALPHA)?n.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(n.opacity={value:e.value(ALPHA)}),n.strokeWidth={value:e.config("strokeWidth")},n}function s(e,t,r){var n={};return e.isMeasure(X)?(n.x={scale:X,field:e.field(X)},e.isDimension(Y)&&(n.x2={scale:X,value:0},n.orient={value:"horizontal"})):n.x=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isMeasure(Y)?(n.y={scale:Y,field:e.field(Y)},n.y2={scale:Y,value:0}):n.y=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.has(COLOR)?n.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(n.fill={value:e.value(COLOR)}),e.has(ALPHA)?n.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(n.opacity={value:e.value(ALPHA)}),n}function o(e,t,r){var n={};return e.has(X)?(n.x={scale:X,field:e.field(X)},e.isDimension(X)&&(n.x.offset=-e.bandSize(X,t.x.useSmallBand)/3)):e.has(X)||(n.x={value:0}),e.has(Y)?(n.y={scale:Y,field:e.field(Y)},e.isDimension(Y)&&(n.y.offset=-e.bandSize(Y,t.y.useSmallBand)/3)):e.has(Y)||(n.y={value:0}),n.width=!e.has(X)||e.isDimension(X)?{value:e.bandSize(X,t.y.useSmallBand)/1.5}:{value:1},n.height=!e.has(Y)||e.isDimension(Y)?{value:e.bandSize(Y,t.y.useSmallBand)/1.5}:{value:1},n.fill=e.has(COLOR)?{scale:COLOR,field:e.field(COLOR)}:{value:e.value(COLOR)},e.has(ALPHA)?n.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?n.opacity={value:e.value(ALPHA)}:e.has(COLOR)||(n.opacity={value:r.opacity}),n}function l(e){return function(t,r,n){var a={};return t.has(X)?a.x={scale:X,field:t.field(X)}:t.has(X)||(a.x={value:t.bandSize(X,r.x.useSmallBand)/2}),t.has(Y)?a.y={scale:Y,field:t.field(Y)}:t.has(Y)||(a.y={value:t.bandSize(Y,r.y.useSmallBand)/2}),t.has(SIZE)?a.size={scale:SIZE,field:t.field(SIZE)}:t.has(X)||(a.size={value:t.value(SIZE)}),a.shape={value:e},t.has(COLOR)?a.fill={scale:COLOR,field:t.field(COLOR)}:t.has(COLOR)||(a.fill={value:t.value(COLOR)}),t.has(ALPHA)?a.opacity={scale:ALPHA,field:t.field(ALPHA)}:void 0!==t.value(ALPHA)?a.opacity={value:t.value(ALPHA)}:t.has(COLOR)||(a.opacity={value:n.opacity}),a}}function u(e,t,r){var n={};return e.has(X)?n.x={scale:X,field:e.field(X)}:e.has(X)||(n.x=e.has(TEXT)&&e.isType(TEXT,Q)?{value:t.cellWidth-5}:{value:e.bandSize(X,t.x.useSmallBand)/2}),e.has(Y)?n.y={scale:Y,field:e.field(Y)}:e.has(Y)||(n.y={value:e.bandSize(Y,t.y.useSmallBand)/2}),e.has(SIZE)?n.fontSize={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(n.fontSize={value:e.font("size")}),n.fill={value:"black"},n.opacity=e.has(ALPHA)?{scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?{value:e.value(ALPHA)}:{value:r.opacity},e.has(TEXT)?e.isType(TEXT,Q)?(n.text={template:"{{"+e.field(TEXT)+" | number:'.3s'}}"},n.align={value:"right"}):n.text={field:e.field(TEXT)}:n.text={value:"Abc"},n.font={value:e.font("family")},n.fontWeight={value:e.font("weight")},n.fontStyle={value:e.font("style")},n.baseline={value:e.text("baseline")},n}var c=(e("../globals"),e("../util"),e("./scale"),t.exports={});c.def=function(e,t,r,n){var a=[];if(t.marktype()===TEXT&&t.has(COLOR)){var i={x:{value:0},y:{value:0},x2:{value:r.cellWidth},y2:{value:r.cellHeight},fill:{scale:COLOR,field:t.field(COLOR)}};a.push({type:"rect",from:{data:TABLE},properties:{enter:i,update:i}})}var s=e.prop(t,r,n);return a.push({type:e.type,from:{data:TABLE},properties:{enter:s,update:s}}),a},c.bar={type:"rect",stack:!0,prop:n,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},c.line={type:"line",line:!0,prop:i,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1,detail:1}},c.area={type:"area",stack:!0,line:!0,requiredEncoding:["x","y"],prop:s,supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1}},c.tick={type:"rect",prop:o,supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1,detail:1}},c.circle={type:"symbol",prop:l("circle"),supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,detail:1}},c.square={type:"symbol",prop:l("square"),supportedEncoding:c.circle.supportedEncoding},c.point={type:"symbol",prop:a,supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,shape:1,detail:1}},c.text={type:"text",prop:u,requiredEncoding:["text"],supportedEncoding:{row:1,col:1,size:1,color:1,alpha:1,text:1}}},{"../globals":24,"../util":27,"./scale":13}],13:[function(e,t,r){"use strict";function n(e,t,r,n){if(t.isType(e,T)){var a=s.scale.domain(t.fn(e),e);if(a)return a}if(t.bin(e)&&n.stats){var o=i.getbins(n.stats[t.fieldName(e)],t.bin(e).maxbins),l=i.range(o.start,o.stop,o.step);return e===Y?l.reverse():l}return e==n.stack?{data:STACKED,field:"data."+(n.facet?"max_":"")+"sum_"+t.field(e,!0)}:{data:r.getDataset(e),field:t.field(e)}}function a(e,t,r,n,a){var i=t.scale(e.name);switch(e.name){case X:"ordinal"===e.type?e.bandWidth=t.bandSize(X,r.x.useSmallBand):(e.range=r.cellWidth?[0,r.cellWidth]:"width",e.zero=t.isType(e.name,T)&&"year"===t.fn(e.name)?!1:void 0===i.zero?!0:i.zero,e.reverse=i.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name):!0;break;case Y:"ordinal"===e.type?e.bandWidth=t.bandSize(Y,r.y.useSmallBand):(e.range=r.cellHeight?[r.cellHeight,0]:"height",e.zero=t.isType(e.name,T)&&"year"===t.fn(e.name)?!1:void 0===i.zero?!0:i.zero,e.reverse=i.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name)||t.config("timeScaleNice"):!0;break;case ROW:e.bandWidth=r.cellHeight,e.round=!0,e.nice=!0;break;case COL:e.bandWidth=r.cellWidth,e.round=!0,e.nice=!0;break;case SIZE:if(t.is("bar"))e.range=[3,Math.max(t.bandSize(X),t.bandSize(Y))];else if(t.is(TEXT))e.range=[8,40];else{var s=Math.min(t.bandSize(X),t.bandSize(Y))-1;e.range=[10,.8*s*s]}e.round=!0,e.zero=!1;break;case SHAPE:e.range="shapes";break;case COLOR:var o=t.scale(COLOR).range;void 0===o&&("ordinal"===e.type?o=n.colorRange:(o=["#A9DB9F","#0D5C21"],e.zero=!1)),e.range=o;break;case ALPHA:e.range=[.2,1];break;default:throw new Error("Unknown encoding name: "+e.name)}switch(e.name){case ROW:case COL:e.padding=t.config("cellPadding"),e.outerPadding=0;break;case X:case Y:"ordinal"===e.type&&(e.points=!0,e.padding=t.band(e.name).padding)}}var i=(e("../globals"),e("../util")),s=e("./time"),o=t.exports={};o.names=function(e){return i.keys(i.keys(e).reduce(function(t,r){return e[r]&&e[r].scale&&(t[e[r].scale]=1),t},{}))},o.defs=function(e,t,r,i,s,l){return l=l||{},e.reduce(function(e,u){var c={name:u,type:o.type(u,t),domain:n(u,t,s,l)};return"ordinal"!==c.type||t.bin(u)||0!==t.sort(u).length||(c.sort=!0),a(c,t,r,i,l),e.push(c),e},[])},o.type=function(e,t){switch(t.type(e)){case O:return"ordinal";case T:var r=t.fn(e);return r&&s.scale.type(r,e)||"time";case Q:return t.bin(e)?e===COLOR?"linear":"ordinal":t.scale(e).type}}},{"../globals":24,"../util":27,"./time":19}],14:[function(e,t,r){"use strict";function n(e,t,r,n){var a={},i=0;return t.forEach(function(n,s){var o=t.sort(s,r);if(o.length>0){var l=o.map(function(e){return{op:e.aggr,field:"data."+e.name}}),u=o.map(function(e){var t=e.reverse?"-":"";return t+"data."+("count"===e.aggr?"count":e.aggr+"_"+e.name)}),c="sorted"+i++,f=[{type:"aggregate",groupby:["data."+n.name],fields:l},{type:"sort",by:u}];e.data.push({name:c,source:RAW,transform:f}),a[s]=c}}),{spec:e,getDataset:function(e){var t=a[e];return t?t:TABLE}}}e("../globals");t.exports=n},{"../globals":24}],15:[function(e,t,r){"use strict";function n(e,t,r,n){if(!a[t.marktype()].stack)return!1;if(!t.has(COLOR))return!1;var i=null,s=null,o=null,l=t.isMeasure(X),u=t.isMeasure(Y);if(l&&!u)i=Y,s=X,o=0;else{if(!u||l)return null;i=X,s=Y,o=1}var c={name:STACKED,source:TABLE,transform:[{type:"aggregate",groupby:[t.field(i)].concat(n),fields:[{op:"sum",field:t.field(s)}]}]};return n&&n.length>0&&c.transform.push({type:"aggregate",groupby:n,fields:[{op:"max",field:"data.sum_"+t.field(s,!0)}]}),e.data.push(c),r.from.transform=[{type:"stack",point:t.field(i),height:t.field(s),output:{y1:s,y0:s+"2"}}],r.properties.update[s]=r.properties.enter[s]={scale:s,field:s},r.properties.update[s+"2"]=r.properties.enter[s+"2"]={scale:s,field:s+"2"},s}var a=(e("../globals"),e("../util"),e("./marks"));t.exports=n},{"../globals":24,"../util":27,"./marks":12}],16:[function(e,t,r){"use strict";function n(e,t){if(e.has(COLOR)&&e.isDimension(COLOR)){var r=e.cardinality(COLOR,t);return 10>=r?"category10":"category20"}return null}function a(e,t){if(!t)return 1;var r=0;if(e.isAggregate())r=1,e.forEach(function(n,a){a===ROW||a===COL||(a===X||a===Y)&&i.isOrdinalScale(n,!0)||(r*=e.cardinality(a,t))});else{r=t.count;var n=1;e.has(ROW)&&(n*=e.cardinality(ROW,t)),e.has(COL)&&(n*=e.cardinality(COL,t)),r/=n}var a=0;return a=20>r?1:200>r?.7:1e3>r||e.is("tick")?.6:.3}{var i=(e("../globals"),e("../util"),e("../field"));e("../Encoding")}t.exports=function(e,t){return{opacity:a(e,t),colorRange:n(e,t)}}},{"../Encoding":2,"../field":23,"../globals":24,"../util":27}],17:[function(e,t,r){"use strict";function n(e,t,r,n,i){var s=e.marks,o=a("subfacet",{marks:s});e.marks=[o],o.from=t.from,delete t.from;var l=o.from.transform||(o.from.transform=[]);l.unshift({type:"facet",keys:r}),n&&i.has(COLOR)&&l.unshift({type:"sort",by:i.field(COLOR)})}var a=(e("../globals"),e("./group").def);t.exports=n},{"../globals":24,"./group":9}],18:[function(e,t,r){"use strict";function n(e,t,r){var n={name:RAW,format:{type:e.config("dataFormatType")}},s={name:TABLE,source:RAW},o=i.getUrl(e,r);o&&(n.url=o);var l=e.config("useVegaServer");return e.forEach(function(e,t){var r;e.type==T?(n.format.parse=n.format.parse||{},n.format.parse[e.name]="date"):e.type==Q&&(n.format.parse=n.format.parse||{},r="count"===e.aggr?"count":l&&e.bin?"bin_"+e.name:l&&e.aggr?e.aggr+"_"+e.name:e.name,n.format.parse[r]="number")}),{width:t.width,height:t.height,padding:"auto",data:[n,s],marks:[a("cell",{width:t.cellWidth?{value:t.cellWidth}:void 0,height:t.cellHeight?{value:t.cellHeight}:void 0})]}}var a=(e("../globals"),e("./group").def),i=e("../data");t.exports=n},{"../data":21,"../globals":24,"./group":9}],19:[function(e,t,r){"use strict";function n(e,t,r){var a={},i={};t.forEach(function(e,r){e.type===T&&e.fn&&(a[t.field(r)]={field:e,encType:r},i[e.fn]=!0)});var s=e.data[1],o=s.transform=s.transform||[];for(var l in a){var u=a[l];n.transform(o,t,u.encType,u.field)}var c=e.scales=e.scales||[];for(var f in i)n.scale(c,f,t);return e}function a(e,t){return"utc"+e+"(d.data."+t.name+")"}var i=(e("../globals"),e("../util"));t.exports=n,n.cardinality=function(e,t,r,n){var a=e.fn;switch(a){case"seconds":return 60;case"minutes":return 60;case"hours":return 24;case"day":return 7;case"date":return 31;case"month":return 12;case"year":var i=t[e.name],s=t["year_"+e.name];return s?s.cardinality-(i.numNulls>0&&r[n]?1:0):null}return null},n.formula=function(e){return a(e.fn,e)},n.transform=function(e,t,r,a){e.push({type:"formula",field:t.field(r),expr:n.formula(a)})},n.scale=function(e,t,r){var n=r.config("timeScaleLabelLength");switch(t){case"day":e.push({name:"time-"+t,type:"ordinal",domain:i.range(0,7),range:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(e){return e.substr(0,n)})});break;case"month":e.push({name:"time-"+t,type:"ordinal",domain:i.range(0,12),range:["January","February","March","April","May","June","July","August","September","October","November","December"].map(function(e){return e.substr(0,n)})})}},n.isOrdinalFn=function(e){switch(e){case"seconds":case"minutes":case"hours":case"day":case"date":case"month":return!0}return!1},n.scale.type=function(e,t){return t===COLOR?"linear":n.isOrdinalFn(e)||t===COL||t===ROW?"ordinal":"linear"},n.scale.domain=function(e,t){var r=t===COLOR;switch(e){case"seconds":case"minutes":return r?[0,59]:i.range(0,60);case"hours":return r?[0,23]:i.range(0,24);case"day":return r?[0,6]:i.range(0,7);case"date":return r?[1,31]:i.range(1,32);case"month":return r?[0,11]:i.range(0,12)}return null},n.hasScale=function(e){switch(e){case"day":case"month":return!0}return!1}},{"../globals":24,"../util":27}],20:[function(e,t,r){"use strict";var n=(e("./globals"),t.exports={});n.encodingTypes=[X,Y,ROW,COL,SIZE,SHAPE,COLOR,ALPHA,TEXT,DETAIL],n.dataTypes={O:O,Q:Q,T:T},n.dataTypeNames=["O","Q","T"].reduce(function(e,t){return e[n.dataTypes[t]]=t,e},{}),n.shorthand={delim:"|",assign:"=",type:",",func:"_"}},{"./globals":24}],21:[function(e,t,r){"use strict";var n=e("./util"),a=t.exports={},i=e("./field");a.getUrl=function(e,t){if(!e.config("useVegaServer"))return e.config("dataUrl");if(0!==e.length()){var r=[];e.forEach(function(a,i){var s={name:e.field(i,!0),field:a.name};a.aggr&&(s.aggr=a.aggr),a.bin&&(s.binSize=n.getbins(t[a.name],e.bin(i).maxbins).step),r.push(s)});var a={table:e.config("vegaServerTable"),fields:r};return e.config("vegaServerUrl")+"/query/?q="+JSON.stringify(a)}},a.getSchema=function(e,t){var r=[],a=n.keys(e[0]);return a.forEach(function(t){for(var a=0,i=e[a][t];""===i||null===i||void 0===i;)i=e[++a][t];i=n.parse(i);var s="number"==typeof i?"Q":i instanceof Date?"T":"O";r.push({name:t,type:s})}),r=n.stablesort(r,t||i.order.typeThenName,i.order.name)},a.getStats=function(e){var t={},r=n.keys(e[0]);return r.forEach(function(r){var a=e.map(function(e){return e[r]}),i=n.parse(e[0][r]),s=("number"==typeof i?"Q":i instanceof Date?"T":"O",{});s=n.minmax("number"==typeof i?n.numbers(a):i instanceof Date?n.dates(a):a),s.cardinality=n.uniq(e,r),
s.count=e.length,s.maxlength=e.reduce(function(e,t){if(null===t[r])return e;var n=t[r].toString().length;return n>e?n:e},0),s.numNulls=e.reduce(function(e,t){return null===t[r]?e+1:e},0);var o=n.numbers(a);o.length>0&&(s.skew=n.skew(o),s.stdev=n.stdev(o),s.mean=n.mean(o),s.median=n.median(o));for(var l={};Object.keys(l).length<Math.min(s.cardinality,10);){var u=e[Math.floor(Math.random()*e.length)][r];l[u]=!0}s.sample=Object.keys(l),t[r]=s}),t.count=e.length,t}},{"./field":23,"./util":27}],22:[function(e,t,r){"use strict";var n=e("./consts"),a=n.shorthand,i=(e("./compile/time"),e("./field")),s=e("./util"),o=e("./schema/schema"),l=o.encTypes,u=t.exports={};u.countRetinal=function(e){var t=0;return e.color&&t++,e.alpha&&t++,e.size&&t++,e.shape&&t++,t},u.has=function(e,t){var r=e&&e[t];return r&&r.name},u.isAggregate=function(e){for(var t in e)if(u.has(e,t)&&e[t].aggr)return!0;return!1},u.forEach=function(e,t){var r=0;l.forEach(function(n){u.has(e,n)&&t(e[n],n,r++)})},u.map=function(e,t){var r=[];return l.forEach(function(n){u.has(e,n)&&r.push(t(e[n],n,e))}),r},u.reduce=function(e,t,r){var n=r;return l.forEach(function(r){u.has(e,r)&&(n=t(n,e[r],r,e))}),n},u.fields=function(e){return u.reduce(e,function(e,t,r){var n=e[t.name]=e[t.name]||[],a=n.containsType=n.containsType||{};return-1===n.indexOf(t)&&(n.push(t),a[t.type]=!0),e},{})},u.shorthand=function(e){return u.map(e,function(e,t){return t+a.assign+i.shorthand(e)}).join(a.delim)},u.fromShorthand=function(e,t){var r=s.isArray(e)?e:e.split(a.delim);return r.reduce(function(e,r){var n=r.split(a.assign),s=n[0].trim(),o=n[1];return e[s]=i.fromShorthand(o,t),e},{})}},{"./compile/time":19,"./consts":20,"./field":23,"./schema/schema":25,"./util":27}],23:[function(e,t,r){"use strict";function n(e){return e?c.isType.byCode:c.isType.byName}function a(e,t){var r=n(t);return r(e,O)||!!e.bin||r(e,T)&&!!e.fn}var i=e("./consts"),s=i.shorthand,o=e("./compile/time"),l=e("./util"),u=e("./schema/schema"),c=t.exports={};c.shorthand=function(e){var t=i.shorthand;return(e.aggr?e.aggr+t.func:"")+(e.fn?e.fn+t.func:"")+(e.bin?"bin"+t.func:"")+(e.name||"")+t.type+(i.dataTypeNames[e.type]||e.type)},c.shorthands=function(e,t){return t=t||s.delim,e.map(c.shorthand).join(t)},c.fromShorthand=function(e,t){var r,n=e.split(s.type),a={name:n[0].trim(),type:t?i.dataTypes[n[1].trim()]:n[1].trim()};for(r in u.aggr["enum"]){var o=u.aggr["enum"][r];if(0===a.name.indexOf(o+"_")){a.name=a.name.substr(o.length+1),"count"==o&&0===a.name.length&&(a.name="*"),a.aggr=o;break}}for(r in u.timefns){var l=u.timefns[r];if(a.name&&0===a.name.indexOf(l+"_")){a.name=a.name.substr(a.length+1),a.fn=l;break}}return a.name&&0===a.name.indexOf("bin_")&&(a.name=a.name.substr(4),a.bin=!0),a};var f={O:0,G:1,T:2,Q:3};c.order={},c.order.type=function(e){return"count"===e.aggr?4:f[e.type]},c.order.typeThenName=function(e){return c.order.type(e)+"_"+e.name.toLowerCase()},c.order.original=function(){return 0},c.order.name=function(e){return e.name},c.order.typeThenCardinality=function(e,t){return t[e.name].cardinality},c.isType=function(e,t){return(e.type&t)>0},c.isType.byCode=c.isType,c.isType.byName=function(e,t){return e.type===i.dataTypeNames[t]},c.isType.get=n,c.isOrdinalScale=function(e,t){var r=n(t);return r(e,O)||e.bin||r(e,T)&&e.fn&&o.isOrdinalFn(e.fn)},c.isDimension=function(e,t){return e&&a(e,t)},c.isMeasure=function(e,t){return e&&!a(e,t)},c.role=function(e){return a(e)?"dimension":"measure"},c.count=function(){return{name:"*",aggr:"count",type:"Q",displayName:c.count.displayName}},c.count.displayName="Number of Records",c.isCount=function(e){return"count"===e.aggr},c.cardinality=function(e,t,r,a){var s=n(a),c=a?i.dataTypeNames[e.type]:e.type;if(r=r||{},e.bin){var f=l.getbins(t[e.name],e.bin.maxbins||u.MAXBINS_DEFAULT);return(f.stop-f.start)/f.step}if(s(e,T)){var d=o.cardinality(e,t,r,c);if(null!==d)return d}if(e.aggr)return 1;var p=t[e.name];return p.cardinality-(p.numNulls>0&&r[c]?1:0)}},{"./compile/time":19,"./consts":20,"./schema/schema":25,"./util":27}],24:[function(e,t,r){(function(e){"use strict";var t=e||window;t.TABLE="table",t.RAW="raw",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.ALPHA="alpha",t.TEXT="text",t.DETAIL="detail",t.O=1,t.Q=2,t.T=4}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(e,t,r){"use strict";var n=t.exports={},a=e("../util");n.util=e("./schemautil"),n.marktype={type:"string","enum":["point","tick","bar","line","area","circle","square","text"]},n.aggr={type:"string","enum":["avg","sum","min","max","count"],supportedEnums:{Q:["avg","sum","min","max","count"],O:[],T:["avg","min","max"],"":["count"]},supportedTypes:{Q:!0,O:!0,T:!0,"":!0}},n.band={type:"object",properties:{size:{type:"integer",minimum:0},padding:{type:"integer",minimum:0,"default":1}}},n.getSupportedRole=function(e){return n.schema.properties.enc.properties[e].supportedRole},n.timefns=["year","month","day","date","hours","minutes","seconds"],n.defaultTimeFn="month",n.fn={type:"string","enum":n.timefns,supportedTypes:{T:!0}},n.scale_type={type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:{Q:!0}},n.field={type:"object",properties:{name:{type:"string"}}};var i=a.duplicate,s=n.util.merge;n.MAXBINS_DEFAULT=15;var o={type:["boolean","object"],"default":!1,properties:{maxbins:{type:"integer","default":n.MAXBINS_DEFAULT,minimum:2}},supportedTypes:{Q:!0}},l=s(i(n.field),{type:"object",properties:{type:{type:"string","enum":["O","Q","T"]},aggr:n.aggr,fn:n.fn,bin:o,scale:{type:"object",properties:{type:n.scale_type,reverse:{type:"boolean","default":!1,supportedTypes:{Q:!0,T:!0}},zero:{type:"boolean",description:"Include zero","default":!0,supportedTypes:{Q:!0,T:!0}},nice:{type:"string","enum":["second","minute","hour","day","week","month","year"],supportedTypes:{T:!0}}}}}}),u=s(i(n.field),{type:"object",supportedRole:{dimension:!0},properties:{type:{type:"string","enum":["O","Q","T"]},fn:n.fn,bin:o,aggr:{type:"string","enum":["count"],supportedTypes:{O:!0}}}}),c={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0},properties:{axis:{type:"object",properties:{grid:{type:"boolean","default":!0,description:"A flag indicate if gridlines should be created in addition to ticks."},title:{type:"boolean","default":!0,description:"A title for the axis."},titleOffset:{type:"integer","default":void 0,description:"A title offset value for the axis."},format:{type:"string","default":void 0,description:"The formatting pattern for axis labels."},maxLabelLength:{type:"integer","default":25,minimum:0,description:"Truncate labels that are too long."}}}}},f={type:"object",properties:{sort:{type:"array","default":[],items:{type:"object",supportedTypes:{O:!0},required:["name","aggr"],name:{type:"string"},aggr:{type:"string","enum":["avg","sum","min","max","count"]},reverse:{type:"boolean","default":!1}}}}},d={type:"object",properties:{band:n.band}},p={type:"object",properties:{legend:{type:"boolean","default":!0}}},m={type:"object",supportedMarktypes:{text:!0},properties:{text:{type:"object",properties:{align:{type:"string","default":"left"},baseline:{type:"string","default":"middle"},margin:{type:"integer","default":4,minimum:0}}},font:{type:"object",properties:{weight:{type:"string","enum":["normal","bold"],"default":"normal"},size:{type:"integer","default":10,minimum:0},family:{type:"string","default":"Helvetica Neue"},style:{type:"string","default":"normal","enum":["normal","italic"]}}}}},g={type:"object",supportedMarktypes:{point:!0,bar:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"integer","default":30,minimum:0}}},h={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"string",role:"color","default":"steelblue"},scale:{type:"object",properties:{range:{type:["string","array"]}}}}},y={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"number","default":void 0,minimum:0,maximum:1}}},v={type:"object",supportedMarktypes:{point:!0,circle:!0,square:!0},properties:{value:{type:"string","enum":["circle","square","cross","diamond","triangle-up","triangle-down"],"default":"circle"}}},b={type:"object",supportedMarktypes:{point:!0,tick:!0,line:!0,circle:!0,square:!0}},O={properties:{height:{type:"number",minimum:0,"default":150},grid:{type:"boolean","default":!0,description:"A flag indicate if gridlines should be created in addition to ticks."}}},x={properties:{width:{type:"number",minimum:0,"default":150},axis:{properties:{maxLabelLength:{type:"integer","default":12,minimum:0,description:"Truncate labels that are too long."}}}}},S={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{padding:{type:"number",minimum:0,maximum:1,"default":.1}}},T={required:["name","type"]},L=s(i(l),{supportedRole:{measure:!0,dimension:!0}}),A=s(i(l),{supportedRole:{measure:!0,dimension:"ordinal-only"}}),k=s(i(l),{supportedRole:{measure:!0}}),E=s(i(L),c,d,T,f),C=i(E),X=s(i(u),T,S,f),R=s(i(X),c,O),Y=s(i(X),c,x),w=s(i(A),p,g,f),_=s(i(L),p,h,f),H=s(i(A),y,f),M=s(i(u),p,v,f),W=s(i(u),b,f),z=s(i(k),m,f),N={type:"array",items:{type:"object",properties:{operands:{type:"array",items:{type:["string","boolean","integer","number"]}},operator:{type:"string","enum":[">",">=","=","!=","<","<=","notNull"]}}}},P={type:"object",properties:{width:{type:"integer","default":void 0},height:{type:"integer","default":void 0},viewport:{type:"array",items:{type:"integer"},"default":void 0},gridColor:{type:"string",role:"color","default":"#eeeeee"},filterNull:{type:"object",properties:{O:{type:"boolean","default":!1},Q:{type:"boolean","default":!0},T:{type:"boolean","default":!0}}},toggleSort:{type:"string","default":"O"},singleHeight:{type:"integer","default":200,minimum:0},singleWidth:{type:"integer","default":200,minimum:0},largeBandSize:{type:"integer","default":21,minimum:0},smallBandSize:{type:"integer","default":12,minimum:0},largeBandMaxCardinality:{type:"integer","default":10},cellPadding:{type:"number","default":.1},cellGridColor:{type:"string",role:"color","default":"#aaaaaa"},cellBackgroundColor:{type:"string",role:"color","default":"transparent"},textCellWidth:{type:"integer","default":90,minimum:0},strokeWidth:{type:"integer","default":2,minimum:0},timeScaleLabelLength:{type:"integer","default":3,minimum:0},characterWidth:{type:"integer","default":6},dataFormatType:{type:"string","enum":["json","csv"],"default":"json"},useVegaServer:{type:"boolean","default":!1},dataUrl:{type:"string","default":void 0},vegaServerTable:{type:"string","default":void 0},vegaServerUrl:{type:"string","default":"http://localhost:3001"}}};n.schema={$schema:"http://json-schema.org/draft-04/schema#",description:"Schema for vegalite specification",type:"object",required:["marktype","enc","cfg"],properties:{marktype:n.marktype,enc:{type:"object",properties:{x:E,y:C,row:R,col:Y,size:w,color:_,alpha:H,shape:M,text:z,detail:W}},filter:N,cfg:P}},n.encTypes=a.keys(n.schema.properties.enc.properties),n.instantiate=function(){return n.util.instantiate(n.schema)}},{"../util":27,"./schemautil":26}],26:[function(e,t,r){"use strict";function n(e,t){if("object"!=typeof t||null===t)return e;for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&("object"!=typeof t[r]||null===t[r]?e[r]=t[r]:"object"!=typeof e[r]||null===e[r]?e[r]=n(t[r].constructor===Array?[]:{},t[r]):n(e[r],t[r]));return e}var a=t.exports={},i=e("../util"),s=function(e){return 0===Object.keys(e).length};a.extend=function(e,t){return a.merge(a.instantiate(t),e)},a.instantiate=function(e){var t;if("object"===e.type){var r={};for(var n in e.properties)t=a.instantiate(e.properties[n]),void 0!==t&&(r[n]=t);return r}return"default"in e?(t=e["default"],i.isObject(t)?i.duplicate(t):t):"array"===e.type?[]:void 0},a.subtract=function(e,t){var r={};for(var n in e){var o=t[n],l=e[n];if(!t||o!==l)if("object"==typeof l&&!i.isArray(l)&&o){var u=a.subtract(l,o);s(u)||(r[n]=u)}else(!i.isArray(l)||l.length>0)&&(r[n]=l)}return r},a.merge=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=n(e,arguments[t]);return e}},{"../util":27}],27:[function(e,t,r){"use strict";function n(e,t,r,n){for(;n>r;){var a=r+n>>>1;i.cmp(e[a],t)<0?r=a+1:n=a}return r}function a(e,t,r){var n=0,a=e.split(l);return e=r?(a=a.reverse()).filter(function(e){return n+=e.length,t>=n}).reverse():a.filter(function(e){return n+=e.length,t>=n}),e.length?e.join("").trim():a[0].slice(0,t)}var i=t.exports={};i.keys=function(e){var t,r=[];for(t in e)r.push(t);return r},i.vals=function(e){var t,r=[];for(t in e)r.push(e[t]);return r},i.range=function(e,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=e,e=0)),(t-e)/r==1/0)throw new Error("infinite range");var n,a=[],i=-1;if(0>r)for(;(n=e+r*++i)>t;)a.push(n);else for(;(n=e+r*++i)<t;)a.push(n);return a},i.find=function(e,t){var r=e.filter(function(e){return e[t.name]===t.value});return r.length&&r[0]||null},i.isin=function(e,t){return-1!==t.indexOf(e)},i.uniq=function(e,t){var r,n,a={},i=0;for(r=0;r<e.length;++r)n=e[r][t],a[n]||(a[n]=1,i+=1);return i};var s=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};i.numbers=function(e){for(var t=[],r=0;r<e.length;r++)s(e[r])&&t.push(+e[r]);return t},i.dates=function(e){for(var t=[],r=0;r<e.length;r++){var n=Date.parse(e[r]);isNaN(n)||t.push(new Date(n))}return t},i.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},i.mean=function(e){return e.reduce(function(e,t){return e+t},0)/e.length},i.variance=function(e){for(var t=i.mean(e),r=[],n=0;n<e.length;n++)r.push(Math.pow(e[n]-t,2));return i.mean(r)},i.stablesort=function(e,t,r){var n={};return e.forEach(function(e,t){n[r(e)]=t}),e.sort(function(e,a){var i=t(e),s=t(a);return s>i?-1:i>s?1:n[r(e)]-n[r(a)]}),e},i.stdev=function(e){return Math.sqrt(i.variance(e))},i.skew=function(e){var t=i.mean(e),r=i.median(e),n=i.stdev(e);return 1*(t-r)/n},i.parse=function(e){if(s(e))return+e;var t=Date.parse(e);return isNaN(t)?e:new Date(t)},i.minmax=function(e){for(var t={min:+(1/0),max:-(1/0)},r=0;r<e.length;++r){var n=e[r];null!==n&&((n>t.max||t.max===-(1/0))&&(t.max=n),(n<t.min||t.min===+(1/0))&&(t.min=n))}return t},i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.isObject=function(e){return e===Object(e)},i.isArray=Array.isArray||function(e){return"[object Array]"==toString.call(e)},i.array=function(e){return e?i.isArray(e)?e:[e]:[]},i.forEach=function(e,t,r){if(e.forEach)e.forEach.call(r,t);else for(var n in e)t.call(r,e[n],n,e)},i.reduce=function(e,t,r,n){if(e.reduce)return e.reduce.call(n,t,r);for(var a in e)r=t.call(n,r,e[a],a,e);return r},i.map=function(e,t,r){if(e.map)return e.map.call(r,t);var n=[];for(var a in e)n.push(t.call(r,e[a],a,e))},i.any=function(e,t){var r,n=0;for(r in e)if(t(e[r],r,n++))return!0;return!1},i.all=function(e,t){var r,n=0;for(r in e)if(!t(e[r],r,n++))return!1;return!0},i.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e&&null===t?0:null===e?-1:null===t?1:0/0};var o=function(e,t){return i.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)};i.merge=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=o(e,arguments[t]);return e},i.getbins=function(e,t){return i.bins({min:e.min,max:e.max,maxbins:t})},i.bins=function(e){e=e||{};var t,r,a,i,s=e.maxbins||1024,o=e.base||10,l=e.div||[5,2],u=e.minstep||0,c=Math.log(o),f=Math.ceil(Math.log(s)/c),d=e.min,p=e.max,m=p-d,g=Math.max(u,Math.pow(o,Math.round(Math.log(m)/c)-f)),h=Math.ceil(m/g);if(e.step)g=e.step;else if(e.steps)g=e.steps[Math.min(e.steps.length-1,n(e.steps,m/s,0,e.steps.length))];else{do g*=o,h=Math.ceil(m/g);while(h>s);for(a=0;a<l.length;++a)r=g/l[a],r>=u&&s>=m/r&&(g=r,h=Math.ceil(m/g))}return r=Math.log(g),t=r>=0?0:~~(-r/c)+1,i=(0>d?-1:1)*Math.pow(o,-t-1),d=Math.min(d,Math.floor(d/g+i)*g),p=Math.ceil(p/g)*g,{start:d,stop:p,step:g,unit:t}},i.setter=function(e,t,r,n){for(var a=0;a<t.length-1;++a)e=n||t[a]in e?e[t[a]]:e[t[a]]={};e[t[a]]=r},i.getter=function(e,t,r){for(var n=0;n<t.length;++n)e=r||t[n]in e?e[t[n]]:e[t[n]]={};return e},i.truncate=function(e,t,r,n,i){var s=e.length;if(t>=s)return e;i=i||"...";var o=Math.max(0,t-i.length);switch(r){case"left":return i+(n?a(e,o,1):e.slice(s-o));case"middle":case"center":var l=Math.ceil(o/2),u=Math.floor(o/2);return(n?a(e,l):e.slice(0,l))+i+(n?a(e,u,1):e.slice(s-u));default:return(n?a(e,o):e.slice(0,o))+i}};var l=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;i.error=function(e){console.error("[VL Error]",e)}},{}]},{},[1])(1)});
//# sourceMappingURL=vegalite.min.js.map